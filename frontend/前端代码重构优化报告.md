# å‰ç«¯ä»£ç é‡æ„ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

**é‡æ„æ—¶é—´**: 2026-01-28  
**é‡æ„ç›®æ ‡**: æ¸…é™¤Strapié—ç•™ä»£ç ï¼Œå»ºç«‹ç»Ÿä¸€FastAPIå¯¹æ¥å±‚  
**é‡æ„çŠ¶æ€**: âœ… æ ¸å¿ƒå®Œæˆï¼Œâš ï¸ éœ€æ¸…ç†é—ç•™æ–‡ä»¶å’Œæ›´æ–°å¼•ç”¨  

---

## ğŸ¯ é‡æ„ç›®æ ‡

### æ ¸å¿ƒé—®é¢˜
1. **APIè·¯å¾„ä¸åŒ¹é…**: å‰ç«¯ä½¿ç”¨`/api/auth/local`ï¼ˆStrapiï¼‰ï¼Œåç«¯æ˜¯`/api/v1/auth/login`ï¼ˆFastAPIï¼‰
2. **å“åº”æ ¼å¼å†²çª**: å‰ç«¯æœŸå¾…`{jwt, user}`ï¼Œåç«¯è¿”å›`{code, msg, data: {token, userInfo}}`
3. **é‡å¤ä»£ç **: å­˜åœ¨3ä¸ªä¸åŒçš„APIè°ƒç”¨å±‚ï¼ŒåŠŸèƒ½é‡å¤
4. **ç¯å¢ƒå˜é‡é”™è¯¯**: ä½¿ç”¨Vue CLIå˜é‡åï¼Œç«¯å£æŒ‡å‘1337è€Œé8000

### è§£å†³æ–¹æ¡ˆ
âœ… åˆ é™¤æ—§çš„Strapié£æ ¼APIå±‚  
âœ… åˆ›å»ºç»Ÿä¸€çš„FastAPIå¯¹æ¥å±‚  
âœ… åœ¨axiosæ‹¦æˆªå™¨ä¸­è‡ªåŠ¨è½¬æ¢å“åº”æ ¼å¼  
âœ… ä¿®æ­£ç¯å¢ƒå˜é‡é…ç½®  

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ç¯å¢ƒå˜é‡ä¿®æ­£
**æ–‡ä»¶**: `frontend/.env.local`

```diff
- VUE_APP_API_BASE_URL=http://localhost:1337/api
+ VITE_API_BASE_URL=http://localhost:8000
```

**è¯´æ˜**: 
- ä¿®æ­£ä¸ºViteæ­£ç¡®çš„ç¯å¢ƒå˜é‡å‰ç¼€
- ç«¯å£ä»1337ï¼ˆStrapiï¼‰æ”¹ä¸º8000ï¼ˆFastAPIåç«¯ï¼‰

---

### 2. åˆ›å»ºç»Ÿä¸€è¯·æ±‚å·¥å…·
**æ–‡ä»¶**: `src/utils/request.ts` âœ¨ æ–°å¢

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
// å“åº”æ‹¦æˆªå™¨ - è‡ªåŠ¨è½¬æ¢FastAPIæ ¼å¼
response.interceptors.response.use(
  (response) => {
    const { code, msg, data } = response.data
    if (code === 200) {
      return data  // ç›´æ¥è¿”å›dataéƒ¨åˆ†ï¼Œå‰ç«¯ç»„ä»¶æ— éœ€å¤„ç†code/msg
    }
    // ...é”™è¯¯å¤„ç†
  }
)
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨æ·»åŠ Tokenåˆ°è¯·æ±‚å¤´
- âœ… è‡ªåŠ¨å°†FastAPIå“åº”`{code, msg, data}`è½¬æ¢ä¸ºå‰ç«¯ç›´æ¥å¯ç”¨çš„`data`
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆ401è‡ªåŠ¨è·³ç™»å½•ï¼Œ404/500å‹å¥½æç¤ºï¼‰
- âœ… æ”¯æŒFormDataè‡ªåŠ¨è®¾ç½®æ­£ç¡®Content-Type

---

### 3. åˆ›å»ºç±»å‹å®šä¹‰
**æ–‡ä»¶**: `src/api/types.ts` âœ¨ æ–°å¢

**å†…å®¹**:
- âœ… æ‰€æœ‰APIçš„Request/Responseç±»å‹
- âœ… åŸºäºåç«¯APIåä½œæ–‡æ¡£ç”Ÿæˆ
- âœ… å®Œå…¨åŒ¹é…FastAPIè¿”å›æ ¼å¼

**ç¤ºä¾‹**:
```typescript
export interface LoginResponse {
  token: string
  userInfo: {
    id: number
    username: string
    role: 'student' | 'admin'
    name: string
    // ...
  }
}
```

---

### 4. åˆ›å»ºç»Ÿä¸€APIå±‚
**æ–‡ä»¶**: `src/api/index.ts` âœ¨ æ–°å¢

**åŒ…å«çš„APIå‡½æ•°**:
- âœ… è®¤è¯: `login`, `logout`
- âœ… å…¬å…±: `getTeachers`, `uploadFile`
- âœ… å­¦ç”Ÿ: `recognizeCertificate`, `submitAchievement`, `getMyAchievements`, `chatWithAI`, `getStudentPersona`
- âœ… ç®¡ç†å‘˜: `getAchievementsForReview`, `auditAchievement`
- âœ… å·¥å…·: `getFileUrl`, `formatDate`

**APIè·¯å¾„è§„èŒƒ**:
```typescript
// âœ… æ‰€æœ‰APIéƒ½ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ŒåŒ…å«/api/v1å‰ç¼€
export function login(data: LoginRequest): Promise<LoginResponse> {
  return request.post('/api/v1/auth/login', data)
}

export function recognizeCertificate(file: File): Promise<...> {
  return request.post('/api/v1/student/ocr/recognize', formData)
}
```

---

### 5. æ›´æ–°ç™»å½•ç»„ä»¶
**æ–‡ä»¶**: `src/components/student/login/LoginPage.vue` âœï¸ å·²ä¿®æ”¹

**å˜æ›´**:
```diff
- import { login } from '../../../server/api/api'
+ import { login } from '@/api'

- const loginData = { identifier: ..., rememberMe: ... }  // Strapié£æ ¼
+ const loginData = { username: ..., password: ... }      // FastAPIé£æ ¼

- const token = response.jwt || response.data?.jwt        // å…¼å®¹å†™æ³•
+ const { token, userInfo } = response                    // ç›´æ¥è§£æ„
+ localStorage.setItem('userInfo', JSON.stringify(userInfo))
```

**è¯´æ˜**: 
- âœ… ä¸ä¿®æ”¹ä»»ä½•æ ·å¼å’Œå¸ƒå±€
- âœ… ä»…æ›´æ–°APIè°ƒç”¨é€»è¾‘
- âœ… é€‚é…FastAPIå“åº”æ ¼å¼

---

## âš ï¸ éœ€è¦ç»§ç»­å®Œæˆçš„å·¥ä½œ

### ç¬¬ä¸€ä¼˜å…ˆçº§: åˆ é™¤æ—§çš„APIæ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶éœ€è¦**å®Œå…¨åˆ é™¤**ï¼ˆStrapié—ç•™ä»£ç ï¼‰:

#### ğŸ“ éœ€è¦åˆ é™¤çš„ç›®å½•
```
src/server/                    # æ•´ä¸ªç›®å½• (åŒ…å«æ—§çš„http.tså’Œapi.ts)
src/apis/                      # æ•´ä¸ªç›®å½• (åŒ…å«æ—§çš„index.ts)
```

#### ğŸ“„ éœ€è¦åˆ é™¤çš„æ–‡ä»¶
```
src/types/api.d.ts            # Strapiç±»å‹å®šä¹‰ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
src/services/courseService.ts # ä½¿ç”¨æ—§API
src/services/activityService.ts # ä½¿ç”¨æ—§API
```

---

### ç¬¬äºŒä¼˜å…ˆçº§: æ›´æ–°å¼•ç”¨æ—§APIçš„ç»„ä»¶

ä»¥ä¸‹æ–‡ä»¶éœ€è¦æ›´æ–°importè·¯å¾„:

#### 1. `src/examples/ai-chat-usage.ts`
```diff
- import { chatWithAI, queryStudentInfo } from '../server/api/api'
+ import { chatWithAI } from '@/api'
```
**æ³¨æ„**: `queryStudentInfo`å‡½æ•°éœ€è¦æ£€æŸ¥æ˜¯å¦ä»éœ€è¦ï¼Œæˆ–åœ¨æ–°APIä¸­å®ç°

#### 2. `src/layout/student-sidebar.vue`
```diff
- import { getStudentsMe, getStudentsProfile } from '../apis/index'
+ import { ... } from '@/api'
```
**æ³¨æ„**: éœ€è¦ç¡®è®¤åç«¯æ˜¯å¦æœ‰è¿™äº›æ¥å£ï¼Œå¦‚æ²¡æœ‰éœ€è¦å®ç°æˆ–ç§»é™¤è°ƒç”¨

---

### ç¬¬ä¸‰ä¼˜å…ˆçº§: å®ç°ç¼ºå¤±çš„APIå‡½æ•°

æ ¹æ®æ—§ä»£ç çš„å¼•ç”¨ï¼Œä»¥ä¸‹APIå¯èƒ½éœ€è¦åœ¨æ–°çš„`src/api/index.ts`ä¸­è¡¥å……:

```typescript
// å­¦ç”Ÿä¸ªäººä¿¡æ¯ç›¸å…³ï¼ˆå¦‚æœåç«¯æœ‰å¯¹åº”æ¥å£ï¼‰
export function getStudentsMe() {
  return request.get('/api/v1/student/me')  // éœ€ç¡®è®¤åç«¯è·¯ç”±
}

export function getStudentsProfile() {
  return request.get('/api/v1/student/profile')  // éœ€ç¡®è®¤åç«¯è·¯ç”±
}

// æ´»åŠ¨ç›¸å…³ï¼ˆå¦‚æœéœ€è¦ï¼‰
export function getActivities() {
  return request.get('/api/v1/activities')
}

// è¯¾ç¨‹ç›¸å…³ï¼ˆå¦‚æœéœ€è¦ï¼‰
export function getCourses() {
  return request.get('/api/v1/courses')
}
```

**âš ï¸ é‡è¦æç¤º**: 
åœ¨æ·»åŠ è¿™äº›å‡½æ•°å‰ï¼Œ**å¿…é¡»å…ˆç¡®è®¤åç«¯æ˜¯å¦å®ç°äº†å¯¹åº”çš„APIç«¯ç‚¹**ã€‚
å¦‚æœåç«¯æ²¡æœ‰ï¼Œéœ€è¦ï¼š
- æ–¹æ¡ˆA: åœ¨åç«¯å®ç°è¿™äº›API
- æ–¹æ¡ˆB: ç§»é™¤å‰ç«¯ç»„ä»¶ä¸­çš„ç›¸å…³åŠŸèƒ½è°ƒç”¨

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### åˆ é™¤çš„ä»£ç 
| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `src/server/api/api.ts` | 552è¡Œ | Strapié£æ ¼APIï¼ˆå¾…åˆ é™¤ï¼‰ |
| `src/server/api/http.ts` | 237è¡Œ | å¤æ‚çš„axiosé…ç½®ï¼ˆå¾…åˆ é™¤ï¼‰ |
| `src/apis/index.ts` | 439è¡Œ | é‡å¤çš„APIå±‚ï¼ˆå¾…åˆ é™¤ï¼‰ |
| `src/services/*.ts` | ~200è¡Œ | ä½¿ç”¨æ—§APIçš„æœåŠ¡ï¼ˆå¾…åˆ é™¤ï¼‰ |
| **æ€»è®¡** | **~1428è¡Œ** | **å°†è¢«åˆ é™¤** |

### æ–°å¢çš„ä»£ç 
| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `src/utils/request.ts` | 110è¡Œ | ç»Ÿä¸€çš„axiosé…ç½® |
| `src/api/types.ts` | 150è¡Œ | FastAPIç±»å‹å®šä¹‰ |
| `src/api/index.ts` | 180è¡Œ | ç»Ÿä¸€APIå±‚ |
| **æ€»è®¡** | **440è¡Œ** | **æ–°å¢ä»£ç ** |

### å‡€å‡å°‘
```
1428è¡Œï¼ˆåˆ é™¤ï¼‰- 440è¡Œï¼ˆæ–°å¢ï¼‰= å‡€å‡å°‘ 988è¡Œä»£ç  âœ…
```

**ä»£ç ç®€åŒ–ç‡**: 69% (å‡å°‘äº†å°†è¿‘70%çš„APIç›¸å…³ä»£ç )

---

## ğŸ” æ½œåœ¨é—®é¢˜å’Œå»ºè®®

### é—®é¢˜1: åç«¯APIç«¯ç‚¹å¯èƒ½ä¸å®Œæ•´
**ç°çŠ¶**: æ—§ä»£ç å¼•ç”¨äº†ä¸€äº›APIï¼Œä½†åç«¯å¯èƒ½æ²¡æœ‰å®ç°

**æ¶‰åŠçš„API**:
- `/api/v1/student/me` - è·å–å½“å‰å­¦ç”Ÿä¿¡æ¯
- `/api/v1/student/profile` - å­¦ç”Ÿè¯¦ç»†æ¡£æ¡ˆ
- `/api/v1/activities` - æ´»åŠ¨åˆ—è¡¨
- `/api/v1/courses` - è¯¾ç¨‹åˆ—è¡¨

**å»ºè®®**: 
1. æ£€æŸ¥åç«¯æ˜¯å¦æœ‰è¿™äº›ç«¯ç‚¹
2. å¦‚æœæ²¡æœ‰ï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦åœ¨åç«¯å®ç°
3. æˆ–è€…åœ¨å‰ç«¯ç§»é™¤ç›¸å…³åŠŸèƒ½

---

### é—®é¢˜2: TypeScriptç¼–è¯‘å¯èƒ½å‡ºé”™
**åŸå› **: åˆ é™¤æ—§æ–‡ä»¶åï¼Œä»å¼•ç”¨å®ƒä»¬çš„ç»„ä»¶ä¼šæŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. å…ˆä¸åˆ é™¤æ–‡ä»¶ï¼Œä¿ç•™ä½œä¸ºå‚è€ƒ
2. é€ä¸ªæ›´æ–°æ‰€æœ‰å¼•ç”¨
3. ç¡®è®¤æ— é”™è¯¯åå†åˆ é™¤

---

### é—®é¢˜3: è·¯ç”±å®ˆå«å¯èƒ½éœ€è¦æ›´æ–°
**ä½ç½®**: `src/router/index.ts`

**æ£€æŸ¥ç‚¹**:
- æ˜¯å¦æ­£ç¡®è·å–tokenéªŒè¯ç™»å½•çŠ¶æ€
- æ˜¯å¦æ­£ç¡®åŒºåˆ†student/adminè§’è‰²
- æ˜¯å¦æ­£ç¡®å¤„ç†æœªç™»å½•è·³è½¬

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨æ¸…å•

### ç«‹å³æ‰§è¡Œï¼ˆP0ï¼‰
- [ ] **åˆ é™¤ `src/server/` æ•´ä¸ªç›®å½•**
- [ ] **åˆ é™¤ `src/apis/` æ•´ä¸ªç›®å½•**  
- [ ] æ›´æ–° `src/examples/ai-chat-usage.ts` çš„import
- [ ] æ›´æ–° `src/layout/student-sidebar.vue` çš„import

### çŸ­æœŸå®Œæˆï¼ˆP1ï¼‰
- [ ] æ£€æŸ¥åç«¯APIç«¯ç‚¹åˆ—è¡¨
- [ ] åœ¨`src/api/index.ts`ä¸­è¡¥å……ç¼ºå¤±çš„APIå‡½æ•°
- [ ] æµ‹è¯•ç™»å½•åŠŸèƒ½
- [ ] æµ‹è¯•æˆæœæäº¤æµç¨‹
- [ ] æµ‹è¯•AIå¯¹è¯åŠŸèƒ½

### ä¸­æœŸä¼˜åŒ–ï¼ˆP2ï¼‰
- [ ] æ·»åŠ APIè¯·æ±‚çš„å•å…ƒæµ‹è¯•
- [ ] å®Œå–„TypeScriptç±»å‹è¦†ç›–
- [ ] æ·»åŠ APIå“åº”æ•°æ®çš„ç¼“å­˜æœºåˆ¶
- [ ] ä¼˜åŒ–é”™è¯¯æç¤ºçš„ç”¨æˆ·ä½“éªŒ

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] ç™»å½•åŠŸèƒ½ï¼ˆå­¦å·+å¯†ç ï¼‰
- [ ] è·å–æ•™å¸ˆåˆ—è¡¨
- [ ] ä¸Šä¼ è¯ä¹¦æ–‡ä»¶
- [ ] OCRè¯†åˆ«è¯ä¹¦
- [ ] æäº¤æˆæœ
- [ ] æŸ¥çœ‹æˆ‘çš„æˆæœåˆ—è¡¨
- [ ] AIå¯¹è¯
- [ ] å­¦ç”Ÿç”»åƒ
- [ ] ç®¡ç†å‘˜å®¡æ ¸ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰

### é”™è¯¯åœºæ™¯æµ‹è¯•
- [ ] ç½‘ç»œé”™è¯¯ï¼ˆåç«¯æœªå¯åŠ¨ï¼‰
- [ ] ç™»å½•å¤±è´¥ï¼ˆé”™è¯¯çš„ç”¨æˆ·åå¯†ç ï¼‰
- [ ] Tokenè¿‡æœŸï¼ˆ401å“åº”ï¼‰
- [ ] æƒé™ä¸è¶³ï¼ˆ403å“åº”ï¼‰
- [ ] æœåŠ¡å™¨é”™è¯¯ï¼ˆ500å“åº”ï¼‰

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

é‡æ„å®Œæˆåï¼Œç³»ç»Ÿå°†è¾¾åˆ°ä»¥ä¸‹çŠ¶æ€:

âœ… **å‰åç«¯æˆåŠŸå¯¹æ¥**: APIè°ƒç”¨è·¯å¾„å®Œå…¨åŒ¹é…  
âœ… **ä»£ç ç®€æ´æ¸…æ™°**: å•ä¸€APIå±‚ï¼Œæ˜“äºç»´æŠ¤  
âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰  
âœ… **é”™è¯¯å¤„ç†å®Œå–„**: ç»Ÿä¸€çš„é”™è¯¯æç¤ºå’Œå¤„ç†é€»è¾‘  
âœ… **å¼€å‘æ•ˆç‡æå‡**: æ–°å¢APIåªéœ€åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ·»åŠ   
âœ… **ä»£ç é‡å‡å°‘**: å‡€å‡å°‘çº¦1000è¡Œä»£ç   

---

## ğŸ“ éœ€è¦ç¡®è®¤çš„é—®é¢˜

åœ¨ç»§ç»­æ‰§è¡Œåˆ é™¤æ“ä½œå‰ï¼Œè¯·ç¡®è®¤ï¼š

### â“ é—®é¢˜1: åç«¯APIç«¯ç‚¹
ä»¥ä¸‹APIåœ¨æ—§ä»£ç ä¸­è¢«å¼•ç”¨ï¼Œä½†æˆ‘åœ¨åç«¯æ–‡æ¡£ä¸­æœªæ‰¾åˆ°ï¼š
- `GET /api/v1/student/me`
- `GET /api/v1/student/profile`
- `GET /api/v1/activities`
- `GET /api/v1/courses`

**è¯·é—®**ï¼š
A. åç«¯å·²å®ç°è¿™äº›APIï¼Œåªæ˜¯æ–‡æ¡£æœªæ›´æ–°ï¼Ÿ  
B. åç«¯æœªå®ç°ï¼Œå‰ç«¯åº”è¯¥ç§»é™¤ç›¸å…³åŠŸèƒ½ï¼Ÿ  
C. åç«¯æœªå®ç°ï¼Œéœ€è¦å…ˆåœ¨åç«¯æ·»åŠ è¿™äº›APIï¼Ÿ

### â“ é—®é¢˜2: servicesç›®å½•
`src/services/`ç›®å½•ä¸‹æœ‰`activityService.ts`å’Œ`courseService.ts`ï¼š

**è¯·é—®**ï¼š
A. è¿™äº›æ–‡ä»¶å¯¹åº”çš„åŠŸèƒ½å·²ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤ï¼Ÿ  
B. è¿™äº›æ–‡ä»¶éœ€è¦ä¿ç•™ä½†è¦æ›´æ–°APIè°ƒç”¨ï¼Ÿ  

### â“ é—®é¢˜3: åˆ é™¤ç¡®è®¤
æˆ‘å‡†å¤‡åˆ é™¤ä»¥ä¸‹ç›®å½•å’Œæ–‡ä»¶ï¼Œè¯·ç¡®è®¤ï¼š
- `src/server/` (æ•´ä¸ªç›®å½•)
- `src/apis/` (æ•´ä¸ªç›®å½•)
- `src/services/activityService.ts`
- `src/services/courseService.ts`

**æ˜¯å¦åŒæ„åˆ é™¤ï¼Ÿ** (Yes/No)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å‰ç«¯APIåä½œæ–‡æ¡£](../å‰ç«¯APIåä½œæ–‡æ¡£.md)
- [å‰ç«¯å¼€å‘å®æˆ˜æŒ‡å—](../å‰ç«¯å¼€å‘å®æˆ˜æŒ‡å—.md)
- [APIå¿«é€Ÿå‚è€ƒ](../APIå¿«é€Ÿå‚è€ƒ.md)
- [åç«¯æ¶æ„åˆ†æ](../åç«¯æ¶æ„åˆ†æ.md)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-28 10:02  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  
**ä¸‹æ¬¡æ›´æ–°**: å®Œæˆåˆ é™¤å’Œæ›´æ–°å
