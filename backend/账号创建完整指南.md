# 🎯 创建和测试 student001 账号 - 完整指南

## 📌 当前状态
- ✅ SQL 创建脚本已准备好
- ⏳ 需要执行创建账号
- ⏳ 需要测试登录

---

## 🚀 步骤 1：创建账号

### 方式 A：使用 MySQL 命令行（最快）

```bash
# 打开命令行，执行：
mysql -u root -ppassword067517 student_system < d:\student_system\backend\quick_create_student001.sql
```

### 方式 B：使用 MySQL Workbench 或 phpMyAdmin

1. 打开 MySQL Workbench 或访问 phpMyAdmin
2. 连接到数据库：
   - 主机: localhost
   - 用户: root
   - 密码: password067517
   - 数据库: student_system

3. 打开 `quick_create_student001.sql` 文件
4. 执行全部 SQL 语句

### 方式 C：手动执行 SQL

复制以下 SQL 并在 MySQL 客户端中执行：

```sql
USE student_system;

-- 删除旧数据（如果存在）
DELETE FROM student WHERE user_id IN (SELECT id FROM sys_user WHERE username = 'student001');
DELETE FROM sys_user WHERE username = 'student001';

-- 创建用户
INSERT INTO sys_user (username, password_hash, role) VALUES
('student001', '$argon2id$v=19$m=65536,t=3,p=4$qXVO6Z2TMiZECA1BSClFKA$8rKZLrcjx7L2QXqFfI0HvT9y4VZJ7QqGxH0bKqLPnqY', 'student');

-- 创建学生信息
INSERT INTO student (user_id, student_id, name, class_name) VALUES
(LAST_INSERT_ID(), '2021001', '张三', '计算机1班');

-- 验证
SELECT * FROM sys_user WHERE username = 'student001';
```

---

## ✅ 步骤 2：验证账号创建

执行以下 SQL 查询：

```sql
USE student_system;

SELECT 
    u.id,
    u.username,
    u.role,
    s.student_id,
    s.name,
    s.class_name
FROM sys_user u
LEFT JOIN student s ON u.id = s.user_id
WHERE u.username = 'student001';
```

**预期结果：**
```
id  | username    | role    | student_id | name | class_name
----|-------------|---------|------------|------|------------
X   | student001  | student | 2021001    | 张三 | 计算机1班
```

**如果看到这个结果 → 账号创建成功！✅**

---

## 🔐 步骤 3：测试登录

### 3.1 确保后端正在运行

```bash
cd d:\student_system\backend
uvicorn main:app --reload
```

**预期输出：**
```
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete.
```

### 3.2 测试登录 API

**方式 A：使用浏览器访问 API 文档**
```
http://localhost:8000/docs
```
找到 `/api/v1/auth/login` 端点，点击 "Try it out"，输入：
```json
{
  "username": "student001",
  "password": "password123"
}
```

**方式 B：使用 curl（如果有）**
```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"student001\",\"password\":\"password123\"}"
```

**预期成功响应：**
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "access_token": "eyJ...",
    "refresh_token": "eyJ...",
    "token_type": "bearer",
    "userInfo": {
      "id": X,
      "name": "张三",
      "role": "student"
    }
  }
}
```

### 3.3 前端登录测试

1. 打开前端应用
2. 输入登录信息：
   - **用户名**: `student001`
   - **密码**: `password123`
3. 点击登录

**预期结果：**
- ✅ 登录成功
- ✅ 跳转到系统主页
- ✅ 显示用户名："张三"

---

## 🔍 故障排查

### 问题 1：SQL 执行失败

**错误：** `Duplicate entry 'student001' for key 'username'`

**解决：** 账号已存在，先删除：
```sql
DELETE FROM student WHERE user_id IN (SELECT id FROM sys_user WHERE username = 'student001');
DELETE FROM sys_user WHERE username = 'student001';
```
然后重新执行创建语句。

### 问题 2：登录返回 401

**可能原因：**
1. 密码不对 - 确认密码是 `password123`
2. 账号不存在 - 重新检查数据库

**解决：** 重置密码
```sql
UPDATE sys_user 
SET password_hash = '$argon2id$v=19$m=65536,t=3,p=4$qXVO6Z2TMiZECA1BSClFKA$8rKZLrcjx7L2QXqFfI0HvT9y4VZJ7QqGxH0bKqLPnqY'
WHERE username = 'student001';
```

### 问题 3：登录返回 500

**可能原因：**
1. 后端未运行
2. 数据库连接失败
3. 后端代码错误

**解决：**
1. 检查后端控制台的错误日志
2. 确认数据库服务正在运行
3. 重启后端

### 问题 4：前端无法连接后端

**检查：**
1. 后端是否运行在 http://localhost:8000
2. 前端 API 配置是否正确
3. 浏览器控制台是否有 CORS 错误

---

## 📋 完整检查清单

在尝试登录前，确认以下项目：

- [ ] MySQL 服务正在运行
- [ ] student001 账号已在数据库中创建
- [ ] 账号包含学生信息（student 表有记录）
- [ ] 后端服务正在运行（http://localhost:8000）
- [ ] 后端无错误日志
- [ ] 前端应用正在运行
- [ ] 前端正确连接到后端

---

## 🎓 登录凭据

**记住这些信息：**
- 用户名: `student001`
- 密码: `password123`
- 姓名: 张三
- 学号: 2021001
- 班级: 计算机1班

---

## 💡 快速命令参考

```bash
# 1. 创建账号
mysql -u root -ppassword067517 student_system < quick_create_student001.sql

# 2. 验证账号
mysql -u root -ppassword067517 student_system -e "SELECT username, role FROM sys_user WHERE username='student001'"

# 3. 启动后端
cd d:\student_system\backend
uvicorn main:app --reload

# 4. 测试登录（如果有 curl）
curl -X POST http://localhost:8000/api/v1/auth/login -H "Content-Type: application/json" -d "{\"username\":\"student001\",\"password\":\"password123\"}"
```

---

**准备好了吗？按照步骤 1 → 2 → 3 执行即可！** 🚀
