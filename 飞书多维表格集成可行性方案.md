# é£ä¹¦å¤šç»´è¡¨æ ¼é›†æˆå¯è¡Œæ€§è®¾è®¡æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2026-02-06  
**é€‚ç”¨ç³»ç»Ÿ**: å­¦ç”Ÿæˆæœç®¡ç†å¹³å°  

---

## ğŸ“‹ ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è¿°](#æ–¹æ¡ˆæ¦‚è¿°)
2. [æ¥å£å¼€å‘å½¢å¼](#æ¥å£å¼€å‘å½¢å¼)
3. [é£ä¹¦å¤šç»´è¡¨æ ¼å‡†å¤‡å·¥ä½œ](#é£ä¹¦å¤šç»´è¡¨æ ¼å‡†å¤‡å·¥ä½œ)
4. [APIè°ƒç”¨æ¥å£è®¾è®¡](#apiè°ƒç”¨æ¥å£è®¾è®¡)
5. [UIè®¾è®¡è§„èŒƒ](#uiè®¾è®¡è§„èŒƒ)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [å®Œæ•´å®æ–½æ­¥éª¤](#å®Œæ•´å®æ–½æ­¥éª¤)
8. [é™„å½•ï¼šé£ä¹¦è¡¨æ ¼æ¨¡æ¿ç¤ºä¾‹](#é™„å½•é£ä¹¦è¡¨æ ¼æ¨¡æ¿ç¤ºä¾‹)

---

## æ–¹æ¡ˆæ¦‚è¿°

### æ ¸å¿ƒå®šä½
å°†é£ä¹¦å¤šç»´è¡¨æ ¼ä½œä¸º**æ‰¹é‡æˆæœå½•å…¥çš„è¾…åŠ©å·¥å…·**ï¼Œé€šè¿‡çµæ´»çš„å­—æ®µæ˜ å°„é…ç½®å’Œä¸¥æ ¼çš„æ•°æ®é¢„æ ¡éªŒï¼Œå®ç°ç»„ç»‡å†…é«˜æ•ˆçš„æˆæœæ•°æ®é‡‡é›†ã€‚

### é›†æˆæ¨¡å¼
- **åªè¯»å¯¼å…¥**ï¼šä»é£ä¹¦å•å‘å¯¼å…¥æ•°æ®åˆ°å¹³å°
- **æ··åˆç”¨æˆ·**ï¼šç®¡ç†å‘˜æ‰¹é‡å¯¼å…¥ + å­¦ç”Ÿè‡ªä¸»å¯¼å…¥
- **ç‹¬ç«‹å·¥å…·**ï¼šä½œä¸ºç‹¬ç«‹çš„å·¥å…·æ åŠŸèƒ½ï¼Œä¸å½±å“ç°æœ‰æµç¨‹
- **æ™ºèƒ½å¤„ç†**ï¼šè¯ä¹¦é™„ä»¶ä¼˜å…ˆä¸‹è½½æœ¬åœ°ï¼Œå¤±è´¥åˆ™ä¿ç•™ä¸´æ—¶é“¾æ¥å¹¶åå°é‡è¯•

### å…³é”®ç‰¹æ€§
âœ… çµæ´»çš„å­—æ®µæ˜ å°„é…ç½®  
âœ… æ•°æ®é¢„æ ¡éªŒæœºåˆ¶  
âœ… æ™ºèƒ½è¯ä¹¦ä¸‹è½½  
âœ… å¯¼å…¥å†å²è¿½æº¯  
âœ… é”™è¯¯è¯¦æƒ…æŠ¥å‘Š  

---

## æ¥å£å¼€å‘å½¢å¼

### 1. æŠ€æœ¯æ¶æ„

```
ã€å‰ç«¯ã€‘Vue 3 + Naive UI + TypeScript
    â†“ HTTP/HTTPS
ã€åç«¯ã€‘FastAPI + Python 3.10+
    â†“ å®˜æ–¹SDK
ã€é£ä¹¦APIã€‘Lark Open Platform API v1
    â†“ OAuth 2.0
ã€é£ä¹¦å¤šç»´è¡¨æ ¼ã€‘Base API
```

### 2. å¼€å‘å½¢å¼è¯´æ˜

#### **åç«¯ï¼šRESTful API**

é‡‡ç”¨FastAPIæ¡†æ¶å¼€å‘æ ‡å‡†çš„RESTful APIæ¥å£ï¼š

```python
# æ¥å£é£æ ¼ç¤ºä¾‹
POST   /api/v1/feishu/config          # ä¿å­˜é£ä¹¦åº”ç”¨é…ç½®
GET    /api/v1/feishu/config          # è·å–å½“å‰é…ç½®
GET    /api/v1/feishu/tables/{app_token}  # åˆ—å‡ºè¡¨æ ¼
POST   /api/v1/feishu/preview         # é¢„è§ˆå¯¼å…¥æ•°æ®
POST   /api/v1/feishu/import          # æ‰§è¡Œå¯¼å…¥
GET    /api/v1/feishu/import-history  # å¯¼å…¥å†å²
```

**æŠ€æœ¯é€‰å‹åŸå› ï¼š**
- FastAPIï¼šé«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ï¼Œå¤©ç„¶æ”¯æŒOpenAPIæ–‡æ¡£
- Pythonå®˜æ–¹SDKï¼š`lark-oapi>=1.2.0`ï¼Œé£ä¹¦å®˜æ–¹ç»´æŠ¤
- SQLAlchemyï¼šORMç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- Pydanticï¼šè‡ªåŠ¨å‚æ•°éªŒè¯å’Œç±»å‹æ£€æŸ¥

#### **å‰ç«¯ï¼šç»„ä»¶åŒ–å¼€å‘**

```
frontend/src/components/
â”œâ”€â”€ admin/feishu/              # ç®¡ç†ç«¯é£ä¹¦åŠŸèƒ½
â”‚   â”œâ”€â”€ FeishuConfig.vue       # åº”ç”¨é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ FieldMappingEditor.vue # å­—æ®µæ˜ å°„ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ FeishuImport.vue       # å¯¼å…¥ä¸»ç•Œé¢
â”‚   â””â”€â”€ ImportHistory.vue      # å¯¼å…¥å†å²
â””â”€â”€ student/honors/
    â””â”€â”€ FeishuQuickImport.vue  # å­¦ç”Ÿç«¯å¿«æ·å¯¼å…¥
```

**ç»„ä»¶é€šä¿¡ï¼š**
- Pinia Storeï¼šå…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆé£ä¹¦é…ç½®ç¼“å­˜ï¼‰
- Event Busï¼šç»„ä»¶é—´æ¶ˆæ¯é€šä¿¡
- Vue Routerï¼šè·¯ç”±å®ˆå«ç¡®ä¿æƒé™

### 3. é£ä¹¦SDKé›†æˆæ–¹å¼

**å®‰è£…ä¾èµ–ï¼š**
```bash
pip install lark-oapi>=1.2.0
```

**åˆå§‹åŒ–SDKï¼š**
```python
from lark_oapi import Client
from lark_oapi.api.bitable.v1 import *

class FeishuService:
    def __init__(self, app_id: str, app_secret: str):
        self.client = Client.builder()
            .app_id(app_id)
            .app_secret(app_secret)
            .build()
    
    async def get_table_records(self, app_token: str, table_id: str):
        """è·å–å¤šç»´è¡¨æ ¼è®°å½•"""
        request = ListAppTableRecordRequest.builder()
            .app_token(app_token)
            .table_id(table_id)
            .build()
        
        response = self.client.bitable.v1.app_table_record.list(request)
        return response.data.items
```

---

## é£ä¹¦å¤šç»´è¡¨æ ¼å‡†å¤‡å·¥ä½œ

### é˜¶æ®µ1ï¼šåˆ›å»ºé£ä¹¦ä¼ä¸šè‡ªå»ºåº”ç”¨

#### æ­¥éª¤1-1ï¼šç™»å½•é£ä¹¦å¼€æ”¾å¹³å°
1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. ä½¿ç”¨ä¼ä¸šç®¡ç†å‘˜è´¦å·ç™»å½•
3. ç‚¹å‡»"å¼€å‘è€…åå°" â†’ "åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨"

#### æ­¥éª¤1-2ï¼šå¡«å†™åº”ç”¨åŸºæœ¬ä¿¡æ¯
```yaml
åº”ç”¨åç§°: å­¦ç”Ÿæˆæœç®¡ç†å¹³å°é›†æˆ
åº”ç”¨æè¿°: ç”¨äºæ‰¹é‡å¯¼å…¥å­¦ç”Ÿæˆæœæ•°æ®åˆ°æˆæœç®¡ç†å¹³å°
åº”ç”¨å›¾æ ‡: ä¸Šä¼ ä¸€ä¸ªå›¾æ ‡ï¼ˆå»ºè®®512x512pxï¼‰
```

#### æ­¥éª¤1-3ï¼šé…ç½®åº”ç”¨æƒé™

**å¿…éœ€çš„æƒé™ï¼ˆé‡è¦ï¼ï¼‰ï¼š**

åœ¨"æƒé™ç®¡ç†"ä¸­ï¼Œ**åŠ¡å¿…å¼€é€šä»¥ä¸‹æ‰€æœ‰æƒé™**ï¼š

**äº‘æ–‡æ¡£æƒé™ï¼ˆ21é¡¹ï¼‰ï¼š**
- âœ… æŸ¥çœ‹ã€è¯„è®ºå’Œå¯¼å‡ºå¤šç»´è¡¨æ ¼
- âœ… æŸ¥çœ‹ã€è¯„è®ºå’Œç¼–è¾‘å¤šç»´è¡¨æ ¼  
- âœ… ç®¡ç†å¤šç»´è¡¨æ ¼
- âœ… æŸ¥çœ‹å¤šç»´è¡¨æ ¼é™„ä»¶
- âœ… ä¸‹è½½å¤šç»´è¡¨æ ¼é™„ä»¶
- âœ… ...ï¼ˆéœ€è¦å‹¾é€‰æ‰€æœ‰äº‘æ–‡æ¡£ç›¸å…³æƒé™ï¼‰

**é€šè®¯å½•æƒé™ï¼ˆå¯é€‰ï¼Œç”¨äºæ•™å¸ˆåŒ¹é…ï¼‰ï¼š**
- âœ… è·å–éƒ¨é—¨åŸºç¡€ä¿¡æ¯
- âœ… è·å–éƒ¨é—¨ç»„ç»‡æ¶æ„ä¿¡æ¯

**æ“ä½œæŠ€å·§ï¼š**
> é£ä¹¦æƒé™é¡µé¢é»˜è®¤åªæ˜¾ç¤ºéƒ¨åˆ†æƒé™ï¼Œéœ€è¦ç‚¹å‡»"å±•å¼€å…¨éƒ¨"å¹¶ä¸Šä¸‹æ»šåŠ¨å¤šæ¬¡ï¼Œç¡®ä¿å‹¾é€‰äº†æ‰€æœ‰21ä¸ªäº‘æ–‡æ¡£æƒé™ã€‚å¦åˆ™APIè°ƒç”¨ä¼šæŠ¥403é”™è¯¯ï¼

#### æ­¥éª¤1-4ï¼šè·å–åº”ç”¨å‡­è¯

åœ¨"å‡­è¯ä¸åŸºç¡€ä¿¡æ¯"é¡µé¢ï¼Œå¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š

```
App ID: cli_a90f276b1638dcd4
App Secret: Bhu7rizYW6Dh4tOOIUDxJbMWVxUsyNuw
```

**âš ï¸ å®‰å…¨æç¤ºï¼š**
- App Secretå¿…é¡»å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æäº¤åˆ°Gitä»“åº“
- å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–åŠ å¯†å­˜å‚¨

#### æ­¥éª¤1-5ï¼šå‘å¸ƒåº”ç”¨

1. è¿›å…¥"ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ"
2. ç‚¹å‡»"åˆ›å»ºç‰ˆæœ¬" â†’ å¡«å†™ç‰ˆæœ¬è¯´æ˜
3. æäº¤å®¡æ ¸
4. ä½œä¸ºä¼ä¸šç®¡ç†å‘˜ï¼Œè‡ªè¡Œå®¡æ ¸é€šè¿‡
5. å…¨å‘˜å¯è§èŒƒå›´è®¾ç½®ä¸º"å…¨éƒ¨æˆå‘˜"

---

### é˜¶æ®µ2ï¼šå‡†å¤‡é£ä¹¦å¤šç»´è¡¨æ ¼

#### æ­¥éª¤2-1ï¼šåˆ›å»ºå¤šç»´è¡¨æ ¼

1. åœ¨é£ä¹¦å·¥ä½œå°ä¸­ï¼Œæ–°å»º"å¤šç»´è¡¨æ ¼"
2. å‘½åï¼š`å­¦ç”Ÿæˆæœæ•°æ®æ”¶é›†è¡¨`
3. è®¾ç½®æƒé™ï¼šå…è®¸ç»„ç»‡æˆå‘˜ç¼–è¾‘

#### æ­¥éª¤2-2ï¼šè®¾è®¡è¡¨æ ¼ç»“æ„

**æ¨èçš„åˆ—ç»“æ„ï¼š**

| åˆ—å | å­—æ®µç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-----|---------|-----|------|------|
| å­¦ç”Ÿå§“å | å•è¡Œæ–‡æœ¬ | âœ… | ç”¨äºåŒ¹é…å­¦ç”Ÿè´¦å· | å¼ ä¸‰ |
| æˆæœæ ‡é¢˜ | å•è¡Œæ–‡æœ¬ | âœ… | æ¯”èµ›/é¡¹ç›®åç§° | 2024å¹´å…¨å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› |
| è·å¥–æ—¥æœŸ | æ—¥æœŸ | âœ… | æ ¼å¼ï¼šYYYY-MM-DD | 2024-09-15 |
| æˆæœç±»åˆ« | å•é€‰ | âœ… | é€‰é¡¹ï¼šç«èµ›ç±»/ç§‘ç ”ç±»/é¡¹ç›®ç±»/è®ºæ–‡ç±»/ä¸“åˆ©ç±»/è¯ä¹¦ç±» | ç«èµ›ç±» |
| å¥–é¡¹ç­‰çº§ | å•é€‰ | âœ… | é€‰é¡¹ï¼šå›½å®¶çº§/çœéƒ¨çº§/æ ¡çº§/é™¢çº§ | å›½å®¶çº§ |
| å…·ä½“å¥–é¡¹ | å•è¡Œæ–‡æœ¬ | âœ… | ä¸€ç­‰å¥–/äºŒç­‰å¥–/ä¸‰ç­‰å¥–/ä¼˜èƒœå¥–ç­‰ | ä¸€ç­‰å¥– |
| æŒ‡å¯¼æ•™å¸ˆ | å•è¡Œæ–‡æœ¬ | âœ… | æ•™å¸ˆå§“åï¼ˆå¤šä½ç”¨é¡¿å·åˆ†éš”ï¼‰ | æè€å¸ˆã€ç‹è€å¸ˆ |
| è¯ä¹¦é™„ä»¶ | é™„ä»¶ | - | ä¸Šä¼ è¯ä¹¦å›¾ç‰‡ | [é™„ä»¶] |
| é¢å‘å•ä½ | å•è¡Œæ–‡æœ¬ | - | å¯é€‰å­—æ®µ | ä¸­å›½æ•°å­¦ä¼š |
| è¯ä¹¦ç¼–å· | å•è¡Œæ–‡æœ¬ | - | å¯é€‰å­—æ®µ | 2024-CUMCM-12345 |
| å¤‡æ³¨ | å¤šè¡Œæ–‡æœ¬ | - | å…¶ä»–è¯´æ˜ | - |

**è¡¨æ ¼æ¨¡æ¿ä¸‹è½½ï¼š** è§é™„å½•

#### æ­¥éª¤2-3ï¼šè·å–è¡¨æ ¼æ ‡è¯†

**æ–¹æ³•1ï¼šä»URLæå–**

æ‰“å¼€å¤šç»´è¡¨æ ¼åï¼Œæµè§ˆå™¨åœ°å€æ æ ¼å¼ä¸ºï¼š
```
https://xxx.feishu.cn/base/YourAppToken?table=YourTableId&view=YourViewId
```

æå–ï¼š
- `app_token`: `YourAppToken`ï¼ˆbase/åé¢çš„éƒ¨åˆ†ï¼‰
- `table_id`: `YourTableId`ï¼ˆtable=åé¢çš„éƒ¨åˆ†ï¼‰

**æ–¹æ³•2ï¼šé€šè¿‡APIè·å–**

```python
# åˆ—å‡ºå¤šç»´è¡¨æ ¼çš„æ‰€æœ‰æ•°æ®è¡¨
from lark_oapi.api.bitable.v1 import ListAppTableRequest

response = client.bitable.v1.app_table.list(
    ListAppTableRequest.builder()
    .app_token("YourAppToken")
    .build()
)

for table in response.data.items:
    print(f"è¡¨æ ¼åç§°: {table.name}, table_id: {table.table_id}")
```

#### æ­¥éª¤2-4ï¼šé…ç½®è¡¨æ ¼æƒé™ï¼ˆé‡è¦ï¼‰

**æƒé™è®¾ç½®ï¼š**
1. ç‚¹å‡»è¡¨æ ¼å³ä¸Šè§’"åˆ†äº«"æŒ‰é’®
2. è®¾ç½®"ç»„ç»‡å†…å¯è§"
3. æƒé™çº§åˆ«ï¼šå¯ç¼–è¾‘ï¼ˆå…è®¸æˆå‘˜å¡«å†™æ•°æ®ï¼‰
4. **å…³é”®æ­¥éª¤**ï¼šç‚¹å‡»"é«˜çº§è®¾ç½®" â†’ å…è®¸"é€šè¿‡é“¾æ¥è®¿é—®"

**âš ï¸ æ³¨æ„ï¼š**
å¦‚æœä¸å¼€å¯"é€šè¿‡é“¾æ¥è®¿é—®"ï¼Œå³ä½¿é…ç½®äº†åº”ç”¨æƒé™ï¼ŒAPIä¹Ÿå¯èƒ½æ— æ³•è¯»å–æ•°æ®ã€‚

---

### é˜¶æ®µ3ï¼šæ‰“å¼€APIè°ƒç”¨æ¥å£

#### æ­¥éª¤3-1ï¼šè·å–Access Token

**é£ä¹¦APIè®¤è¯æµç¨‹ï¼š**

```python
import httpx

async def get_tenant_access_token(app_id: str, app_secret: str) -> str:
    """è·å–ä¼ä¸šçº§è®¿é—®å‡­è¯ï¼ˆæœ‰æ•ˆæœŸ2å°æ—¶ï¼‰"""
    url = "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal"
    
    payload = {
        "app_id": app_id,
        "app_secret": app_secret
    }
    
    async with httpx.AsyncClient() as client:
        response = await client.post(url, json=payload)
        result = response.json()
        
        if result.get("code") == 0:
            return result["tenant_access_token"]
        else:
            raise Exception(f"è·å–Tokenå¤±è´¥: {result.get('msg')}")
```

**Tokenç®¡ç†ç­–ç•¥ï¼š**
- Tokenæœ‰æ•ˆæœŸï¼š2å°æ—¶
- è‡ªåŠ¨åˆ·æ–°ï¼šåœ¨è¿‡æœŸå‰30åˆ†é’Ÿä¸»åŠ¨åˆ·æ–°
- ç¼“å­˜æœºåˆ¶ï¼šä½¿ç”¨Redisæˆ–å†…å­˜ç¼“å­˜ï¼ˆå¸¦è¿‡æœŸæ—¶é—´ï¼‰

```python
class TokenManager:
    def __init__(self):
        self.token = None
        self.expire_time = None
    
    async def get_valid_token(self) -> str:
        # æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ·æ–°
        now = datetime.now()
        if self.token is None or (self.expire_time - now).seconds < 1800:
            self.token = await get_tenant_access_token(app_id, app_secret)
            self.expire_time = now + timedelta(hours=2)
        
        return self.token
```

#### æ­¥éª¤3-2ï¼šè°ƒç”¨å¤šç»´è¡¨æ ¼API

**æ ¸å¿ƒAPIåˆ—è¡¨ï¼š**

| API | æ–¹æ³• | ç”¨é€” |
|-----|------|------|
| `/open-apis/bitable/v1/apps/{app_token}/tables` | GET | åˆ—å‡ºæ‰€æœ‰æ•°æ®è¡¨ |
| `/open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records` | GET | è·å–è®°å½• |
| `/open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records` | POST | åˆ›å»ºè®°å½• |
| `/open-apis/drive/v1/medias/{file_token}/download` | GET | ä¸‹è½½é™„ä»¶ |

**ç¤ºä¾‹ï¼šè¯»å–è¡¨æ ¼è®°å½•**

```python
async def fetch_table_records(app_token: str, table_id: str, token: str):
    url = f"https://open.feishu.cn/open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records"
    
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }
    
    params = {
        "page_size": 100,  # æ¯é¡µæœ€å¤š100æ¡
        "view_id": ""      # ç•™ç©ºåˆ™è¯»å–æ‰€æœ‰è®°å½•
    }
    
    async with httpx.AsyncClient(timeout=30.0) as client:
        response = await client.get(url, headers=headers, params=params)
        result = response.json()
        
        if result.get("code") == 0:
            return result["data"]["items"]
        else:
            raise Exception(f"APIè°ƒç”¨å¤±è´¥: {result.get('msg')}")
```

**è¿”å›æ•°æ®æ ¼å¼ï¼š**
```json
{
  "code": 0,
  "data": {
    "items": [
      {
        "record_id": "recXXXXXXX",
        "fields": {
          "å­¦ç”Ÿå§“å": "å¼ ä¸‰",
          "æˆæœæ ‡é¢˜": "2024å¹´å…¨å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ›",
          "è·å¥–æ—¥æœŸ": 1726416000000,  // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
          "æˆæœç±»åˆ«": "ç«èµ›ç±»",
          "å¥–é¡¹ç­‰çº§": "å›½å®¶çº§",
          "å…·ä½“å¥–é¡¹": "ä¸€ç­‰å¥–",
          "æŒ‡å¯¼æ•™å¸ˆ": "æè€å¸ˆã€ç‹è€å¸ˆ",
          "è¯ä¹¦é™„ä»¶": [
            {
              "file_token": "boxcnXXXXXXXXXX",
              "name": "certificate.jpg",
              "size": 1234567,
              "type": "image/jpeg"
            }
          ]
        }
      }
    ],
    "has_more": false,
    "page_token": ""
  }
}
```

#### æ­¥éª¤3-3ï¼šä¸‹è½½é™„ä»¶

```python
async def download_feishu_file(file_token: str, access_token: str) -> bytes:
    """ä¸‹è½½é£ä¹¦é™„ä»¶"""
    url = f"https://open.feishu.cn/open-apis/drive/v1/medias/{file_token}/download"
    
    headers = {
        "Authorization": f"Bearer {access_token}"
    }
    
    async with httpx.AsyncClient(timeout=60.0) as client:
        response = await client.get(url, headers=headers)
        
        if response.status_code == 200:
            return response.content
        else:
            raise Exception(f"ä¸‹è½½å¤±è´¥: {response.text}")
```

---

## APIè°ƒç”¨æ¥å£è®¾è®¡

### 1. åç«¯æ¥å£æ¸…å•

#### **1.1 é…ç½®ç®¡ç†æ¥å£**

**ä¿å­˜é£ä¹¦åº”ç”¨é…ç½®**
```http
POST /api/v1/feishu/config
Content-Type: application/json
Authorization: Bearer {admin_token}

Request Body:
{
  "app_id": "cli_a1b2c3d4e5f6g7h8",
  "app_secret": "xxxxxxxxxxxx"
}

Response:
{
  "success": true,
  "msg": "é…ç½®ä¿å­˜æˆåŠŸ",
  "data": {
    "config_id": 1,
    "created_at": "2026-02-06T15:30:00Z"
  }
}
```

**è·å–å½“å‰é…ç½®**
```http
GET /api/v1/feishu/config
Authorization: Bearer {admin_token}

Response:
{
  "success": true,
  "data": {
    "id": 1,
    "app_id": "cli_a1b2c3d4e5f6g7h8",
    "app_secret": "******",  // è„±æ•æ˜¾ç¤º
    "status": "active",
    "last_synced": "2026-02-06T15:00:00Z"
  }
}
```

#### **1.2 è¡¨æ ¼æ“ä½œæ¥å£**

**åˆ—å‡ºå¤šç»´è¡¨æ ¼**
```http
GET /api/v1/feishu/tables/{app_token}
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": {
    "tables": [
      {
        "table_id": "tblXXXXXXXX",
        "name": "å­¦ç”Ÿæˆæœæ•°æ®æ”¶é›†è¡¨",
        "record_count": 120
      }
    ]
  }
}
```

#### **1.3 å¯¼å…¥åŠŸèƒ½æ¥å£**

**é¢„è§ˆå¯¼å…¥æ•°æ®**
```http
POST /api/v1/feishu/preview
Authorization: Bearer {token}
Content-Type: application/json

Request Body:
{
  "app_token": "YourAppToken",
  "table_id": "YourTableId",
  "mapping_id": 1,  // å­—æ®µæ˜ å°„é…ç½®ID
  "preview_limit": 50
}

Response:
{
  "success": true,
  "data": {
    "total": 45,
    "valid": 42,
    "invalid": 3,
    "records": [
      {
        "row_number": 1,
        "original_data": {
          "å­¦ç”Ÿå§“å": "å¼ ä¸‰",
          "æˆæœæ ‡é¢˜": "æ•°å­¦å»ºæ¨¡ç«èµ›",
          "æŒ‡å¯¼æ•™å¸ˆ": "æè€å¸ˆ"
        },
        "transformed_data": {
          "student_id": 101,
          "title": "æ•°å­¦å»ºæ¨¡ç«èµ›",
          "teacher_id": 5
        },
        "is_valid": true,
        "validation_errors": []
      },
      {
        "row_number": 2,
        "original_data": {...},
        "transformed_data": {...},
        "is_valid": false,
        "validation_errors": [
          "æœªæ‰¾åˆ°æ•™å¸ˆ: èµµè€å¸ˆ",
          "è·å¥–æ—¥æœŸæ ¼å¼é”™è¯¯"
        ]
      }
    ]
  }
}
```

**æ‰§è¡Œå¯¼å…¥**
```http
POST /api/v1/feishu/import
Authorization: Bearer {token}
Content-Type: application/json

Request Body:
{
  "app_token": "YourAppToken",
  "table_id": "YourTableId",
  "mapping_id": 1,
  "skip_invalid": true  // è·³è¿‡æ— æ•ˆè®°å½•
}

Response:
{
  "success": true,
  "data": {
    "total": 45,
    "imported": 42,
    "failed": 3,
    "details": [
      {
        "row": 2,
        "status": "failed",
        "error": "æœªæ‰¾åˆ°æ•™å¸ˆ: èµµè€å¸ˆ"
      }
    ],
    "import_log_id": 101
  }
}
```

#### **1.4 å­—æ®µæ˜ å°„æ¥å£**

**ä¿å­˜æ˜ å°„é…ç½®**
```http
POST /api/v1/feishu/mapping
Authorization: Bearer {admin_token}
Content-Type: application/json

Request Body:
{
  "name": "æ ‡å‡†æˆæœå¯¼å…¥æ¨¡æ¿",
  "mappings": [
    {
      "feishu_field": "æˆæœæ ‡é¢˜",
      "db_field": "title",
      "is_required": true
    },
    {
      "feishu_field": "æˆæœç±»åˆ«",
      "db_field": "type",
      "is_required": true,
      "transform_rule": {
        "type": "enum_mapping",
        "mapping": {
          "ç«èµ›ç±»": "competition",
          "ç§‘ç ”ç±»": "research",
          "é¡¹ç›®ç±»": "project"
        }
      }
    },
    {
      "feishu_field": "æŒ‡å¯¼æ•™å¸ˆ",
      "db_field": "teacher_id",
      "is_required": true,
      "transform_rule": {
        "type": "teacher_name_to_id",
        "match_mode": "fuzzy"
      }
    }
  ]
}

Response:
{
  "success": true,
  "data": {
    "mapping_id": 1
  }
}
```

### 2. å‰ç«¯APIè°ƒç”¨å°è£…

**`frontend/src/api/feishu.ts`**

```typescript
import { request } from '@/utils/request'

export interface FeishuConfigCreate {
  app_id: string
  app_secret: string
}

export interface FeishuPreviewRequest {
  app_token: string
  table_id: string
  mapping_id: number
  preview_limit?: number
}

export const feishuApi = {
  // ä¿å­˜é…ç½®
  saveConfig(data: FeishuConfigCreate) {
    return request.post('/api/v1/feishu/config', data)
  },
  
  // è·å–é…ç½®
  getConfig() {
    return request.get('/api/v1/feishu/config')
  },
  
  // æµ‹è¯•è¿æ¥
  testConnection() {
    return request.post('/api/v1/feishu/test')
  },
  
  // åˆ—å‡ºè¡¨æ ¼
  listTables(appToken: string) {
    return request.get(`/api/v1/feishu/tables/${appToken}`)
  },
  
  // é¢„è§ˆå¯¼å…¥
  previewImport(data: FeishuPreviewRequest) {
    return request.post('/api/v1/feishu/preview', data)
  },
  
  // æ‰§è¡Œå¯¼å…¥
  executeImport(data: FeishuPreviewRequest & { skip_invalid: boolean }) {
    return request.post('/api/v1/feishu/import', data)
  },
  
  // å¯¼å…¥å†å²
  getImportHistory(params: { page: number; page_size: number }) {
    return request.get('/api/v1/feishu/import-history', { params })
  }
}
```

---

## UIè®¾è®¡è§„èŒƒ

### 1. ä¸»é¢˜è‰²å½©æ–¹æ¡ˆ

åŸºäºNaive UIçš„ç°ä»£åŒ–é…è‰²ï¼š

```css
/* ä¸»é¢˜è‰²å½©å®šä¹‰ */
:root {
  /* é£ä¹¦å“ç‰Œè‰² */
  --feishu-primary: #0089FF;      /* é£ä¹¦è“ */
  --feishu-primary-hover: #0070D9;
  --feishu-primary-active: #005BB3;
  
  /* å¹³å°ä¸»è‰²ï¼ˆä¿æŒä¸€è‡´ï¼‰ */
  --primary-color: #18a058;        /* æˆåŠŸç»¿ */
  --warning-color: #f0a020;        /* è­¦å‘Šæ©™ */
  --error-color: #d03050;          /* é”™è¯¯çº¢ */
  --info-color: #2080f0;           /* ä¿¡æ¯è“ */
  
  /* é£ä¹¦åŠŸèƒ½ä¸“ç”¨è‰² */
  --feishu-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --feishu-card-bg: #f7f8fa;
  --feishu-border: #e4e7ec;
  
  /* çŠ¶æ€è‰² */
  --status-valid: #52c41a;         /* æœ‰æ•ˆè®°å½• */
  --status-invalid: #ff4d4f;       /* æ— æ•ˆè®°å½• */
  --status-processing: #1890ff;    /* å¤„ç†ä¸­ */
}
```

### 2. ç»„ä»¶æ ·å¼è§„èŒƒ

#### **2.1 ç®¡ç†ç«¯ä¸»ç•Œé¢ï¼ˆFeishuImport.vueï¼‰**

**å¸ƒå±€ç»“æ„ï¼š**
```vue
<template>
  <div class="feishu-import-container">
    <!-- å¤´éƒ¨ï¼šé¢åŒ…å±‘å¯¼èˆª -->
    <PageHeader 
      title="é£ä¹¦æ•°æ®å¯¼å…¥" 
      subtitle="æ‰¹é‡å¯¼å…¥å­¦ç”Ÿæˆæœæ•°æ®"
      icon="IconTable"
      :breadcrumbs="['æˆæœç®¡ç†', 'é£ä¹¦é›†æˆ', 'æ•°æ®å¯¼å…¥']"
    />
    
    <!-- æ­¥éª¤æ¡ -->
    <n-steps 
      :current="currentStep" 
      class="import-steps"
      :status="stepStatus"
    >
      <n-step title="é€‰æ‹©è¡¨æ ¼" description="é…ç½®æ•°æ®æº" />
      <n-step title="å­—æ®µæ˜ å°„" description="é…ç½®è½¬æ¢è§„åˆ™" />
      <n-step title="æ•°æ®é¢„è§ˆ" description="æ ¡éªŒæ•°æ®è´¨é‡" />
      <n-step title="æ‰§è¡Œå¯¼å…¥" description="å®Œæˆå¯¼å…¥" />
    </n-steps>
    
    <!-- å†…å®¹åŒºï¼ˆæ ¹æ®stepåŠ¨æ€åˆ‡æ¢ï¼‰ -->
    <n-card class="step-content">
      <component :is="currentStepComponent" />
    </n-card>
  </div>
</template>

<style scoped>
.feishu-import-container {
  padding: 24px;
  max-width: 1400px;
  margin: 0 auto;
  min-height: calc(100vh - 64px);
  background: linear-gradient(180deg, #f0f2f5 0%, #ffffff 100%);
}

.import-steps {
  margin: 32px auto;
  max-width: 800px;
  padding: 24px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.step-content {
  margin-top: 24px;
  border-radius: 12px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}
</style>
```

#### **2.2 æ•°æ®é¢„è§ˆè¡¨æ ¼æ ·å¼**

```vue
<template>
  <n-data-table
    :columns="previewColumns"
    :data="previewData"
    :row-class-name="getRowClassName"
    :max-height="600"
    :scroll-x="1200"
    striped
    virtual-scroll
  >
    <template #empty>
      <n-empty description="æš‚æ— æ•°æ®" />
    </template>
  </n-data-table>
</template>

<script setup lang="ts">
const getRowClassName = (record: PreviewRecord) => {
  if (!record.is_valid) return 'error-row'
  return ''
}

const previewColumns = [
  { key: 'row_number', title: '#', width: 60, fixed: 'left' },
  { 
    key: 'is_valid', 
    title: 'çŠ¶æ€', 
    width: 100,
    render: (row) => h(NTag, { 
      type: row.is_valid ? 'success' : 'error',
      size: 'small',
      round: true
    }, {
      default: () => row.is_valid ? 'âœ“ æœ‰æ•ˆ' : 'âœ— å¼‚å¸¸'
    })
  },
  { key: 'original_data.æˆæœæ ‡é¢˜', title: 'æˆæœæ ‡é¢˜', width: 200, ellipsis: { tooltip: true } },
  { key: 'original_data.å­¦ç”Ÿå§“å', title: 'å­¦ç”Ÿ', width: 100 },
  { key: 'original_data.æŒ‡å¯¼æ•™å¸ˆ', title: 'æ•™å¸ˆ', width: 120 },
  { 
    key: 'validation_errors', 
    title: 'é”™è¯¯ä¿¡æ¯', 
    width: 300,
    render: (row) => {
      if (!row.validation_errors || row.validation_errors.length === 0) {
        return h('span', { style: 'color: #52c41a' }, 'æ— é”™è¯¯')
      }
      return h('div', { class: 'error-messages' }, 
        row.validation_errors.map(err => 
          h('div', { class: 'error-item' }, [
            h('n-icon', { size: 16, color: '#ff4d4f' }, h(IconAlertCircle)),
            h('span', err)
          ])
        )
      )
    }
  }
]
</script>

<style scoped>
:deep(.error-row) {
  background-color: #fff1f0 !important;
  border-left: 3px solid #ff4d4f;
  
  &:hover {
    background-color: #ffe7e6 !important;
  }
}

.error-messages {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.error-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: #ff4d4f;
}
</style>
```

#### **2.3 ç»Ÿè®¡å¡ç‰‡ç»„**

```vue
<template>
  <n-grid :cols="4" :x-gap="16" class="stats-overview">
    <n-grid-item>
      <n-statistic label="æ€»è®¡è®°å½•" :value="stats.total">
        <template #prefix>
          <n-icon :size="24" color="#2080f0">
            <IconDatabase />
          </n-icon>
        </template>
      </n-statistic>
    </n-grid-item>
    
    <n-grid-item>
      <n-statistic label="æœ‰æ•ˆè®°å½•" :value="stats.valid">
        <template #prefix>
          <n-icon :size="24" color="#52c41a">
            <IconCheckCircle />
          </n-icon>
        </template>
      </n-statistic>
    </n-grid-item>
    
    <n-grid-item>
      <n-statistic label="å¼‚å¸¸è®°å½•" :value="stats.invalid">
        <template #prefix>
          <n-icon :size="24" color="#ff4d4f">
            <IconAlertCircle />
          </n-icon>
        </template>
      </n-statistic>
    </n-grid-item>
    
    <n-grid-item>
      <n-statistic label="é€šè¿‡ç‡" :value="successRate + '%'">
        <template #prefix>
          <n-icon :size="24" :color="successRateColor">
            <IconChart />
          </n-icon>
        </template>
      </n-statistic>
    </n-grid-item>
  </n-grid>
</template>

<script setup lang="ts">
const successRate = computed(() => {
  if (stats.total === 0) return 0
  return Math.round((stats.valid / stats.total) * 100)
})

const successRateColor = computed(() => {
  const rate = successRate.value
  if (rate >= 90) return '#52c41a'
  if (rate >= 70) return '#faad14'
  return '#ff4d4f'
})
</script>

<style scoped>
.stats-overview {
  margin-bottom: 24px;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
}

:deep(.n-statistic) {
  background: white;
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

:deep(.n-statistic-value) {
  font-size: 28px;
  font-weight: 600;
}

:deep(.n-statistic__label) {
  font-size: 14px;
  color: #666;
  margin-bottom: 8px;
}
</style>
```

#### **2.4 å­—æ®µæ˜ å°„ç¼–è¾‘å™¨æ ·å¼**

```vue
<template>
  <div class="field-mapping-editor">
    <!-- å·¦ä¾§ï¼šé£ä¹¦å­—æ®µ -->
    <div class="source-panel">
      <h3>é£ä¹¦è¡¨æ ¼å­—æ®µ</h3>
      <n-scrollbar style="max-height: 500px">
        <div 
          v-for="field in feishuFields" 
          :key="field.name"
          class="field-item source-field"
          draggable="true"
          @dragstart="handleDragStart(field)"
        >
          <n-icon :size="18"><IconTable /></n-icon>
          <span>{{ field.name }}</span>
          <n-tag :type="getFieldTypeColor(field.type)" size="small">
            {{ field.type }}
          </n-tag>
        </div>
      </n-scrollbar>
    </div>
    
    <!-- ä¸­é—´ï¼šæ˜ å°„å…³ç³» -->
    <div class="mapping-canvas">
      <svg class="connection-lines">
        <line 
          v-for="(mapping, idx) in mappings" 
          :key="idx"
          :x1="mapping.x1" 
          :y1="mapping.y1"
          :x2="mapping.x2" 
          :y2="mapping.y2"
          stroke="#667eea"
          stroke-width="2"
          stroke-dasharray="5,5"
        />
      </svg>
    </div>
    
    <!-- å³ä¾§ï¼šæ•°æ®åº“å­—æ®µ -->
    <div class="target-panel">
      <h3>æ•°æ®åº“å­—æ®µ</h3>
      <n-scrollbar style="max-height: 500px">
        <div 
          v-for="field in dbFields" 
          :key="field.name"
          class="field-item target-field"
          @drop="handleDrop(field, $event)"
          @dragover.prevent
        >
          <n-icon :size="18"><IconDatabase /></n-icon>
          <span>{{ field.label }}</span>
          <n-tag v-if="field.required" type="error" size="small">å¿…å¡«</n-tag>
          <n-tag v-else type="default" size="small">å¯é€‰</n-tag>
        </div>
      </n-scrollbar>
    </div>
  </div>
</template>

<style scoped>
.field-mapping-editor {
  display: grid;
  grid-template-columns: 1fr 100px 1fr;
  gap: 24px;
  padding: 24px;
  min-height: 600px;
}

.source-panel, .target-panel {
  background: #f7f8fa;
  border-radius: 8px;
  padding: 16px;
}

.source-panel h3, .target-panel h3 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #333;
}

.field-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  margin-bottom: 8px;
  background: white;
  border: 2px solid transparent;
  border-radius: 6px;
  cursor: move;
  transition: all 0.2s;
}

.field-item:hover {
  border-color: #667eea;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
  transform: translateX(4px);
}

.source-field {
  border-left: 4px solid #0089FF;
}

.target-field {
  border-left: 4px solid #18a058;
  cursor: pointer;
}

.mapping-canvas {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.connection-lines {
  width: 100%;
  height: 100%;
}
</style>
```

### 3. å­¦ç”Ÿç«¯å¿«æ·å¯¼å…¥å¼¹çª—

```vue
<template>
  <n-modal 
    v-model:show="visible" 
    preset="card"
    title="é£ä¹¦å¿«æ·å¯¼å…¥"
    style="width: 700px"
    :bordered="false"
    :segmented="{
      content: 'soft',
      footer: 'soft'
    }"
  >
    <template #header-extra>
      <n-tag type="info" size="small" round>
        <template #icon>
          <n-icon><IconFeishu /></n-icon>
        </template>
        å¿«æ·å·¥å…·
      </n-tag>
    </template>
    
    <!-- è¯´æ˜æç¤º -->
    <n-alert type="info" class="mb-4" :bordered="false">
      <template #icon>
        <n-icon><IconInfoCircle /></n-icon>
      </template>
      ä»é£ä¹¦å¤šç»´è¡¨æ ¼å¿«é€Ÿå¯¼å…¥æ‚¨çš„æˆæœè®°å½•ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç­›é€‰æ‚¨çš„æ•°æ®
    </n-alert>
    
    <!-- è¾“å…¥åŒº -->
    <n-form>
      <n-form-item label="é£ä¹¦è¡¨æ ¼é“¾æ¥">
        <n-input 
          v-model:value="tableLink" 
          placeholder="ç²˜è´´é£ä¹¦è¡¨æ ¼é“¾æ¥ï¼Œå¦‚ï¼šhttps://xxx.feishu.cn/base/..."
          size="large"
          @input="autoParseLink"
        >
          <template #prefix>
            <n-icon><IconLink /></n-icon>
          </template>
          <template #suffix>
            <n-button text type="primary" @click="pasteFromClipboard">
              <template #icon><IconClipboard /></template>
              ç²˜è´´
            </n-button>
          </template>
        </n-input>
      </n-form-item>
    </n-form>
    
    <!-- é¢„è§ˆåŒº -->
    <n-card v-if="matchedRecords.length > 0" title="å°†å¯¼å…¥ä»¥ä¸‹è®°å½•" size="small">
      <n-scrollbar style="max-height: 300px">
        <n-list hoverable clickable>
          <n-list-item v-for="record in matchedRecords" :key="record.id">
            <n-thing>
              <template #avatar>
                <n-avatar :style="{ background: getTypeColor(record.type) }">
                  <n-icon><IconAward /></n-icon>
                </n-avatar>
              </template>
              <template #header>{{ record.title }}</template>
              <template #description>
                <n-space>
                  <n-tag size="small" :type="getLevelType(record.level)">
                    {{ record.level }}
                  </n-tag>
                  <n-tag size="small">{{ record.award }}</n-tag>
                  <span style="color: #999">{{ record.date }}</span>
                </n-space>
              </template>
            </n-thing>
          </n-list-item>
        </n-list>
      </n-scrollbar>
    </n-card>
    
    <!-- åº•éƒ¨æ“ä½œ -->
    <template #footer>
      <n-space justify="space-between">
        <n-text depth="3">
          æ‰¾åˆ° <n-text strong type="primary">{{ matchedRecords.length }}</n-text> æ¡åŒ¹é…è®°å½•
        </n-text>
        <n-space>
          <n-button @click="visible = false">å–æ¶ˆ</n-button>
          <n-button 
            type="primary" 
            @click="executeImport"
            :loading="importing"
            :disabled="matchedRecords.length === 0"
          >
            <template #icon><IconDownload /></template>
            å¯¼å…¥
          </n-button>
        </n-space>
      </n-space>
    </template>
  </n-modal>
</template>

<style scoped>
.mb-4 {
  margin-bottom: 16px;
}

:deep(.n-card__content) {
  padding: 12px;
}
</style>
```

### 4. å›¾æ ‡ä½¿ç”¨è§„èŒƒ

```typescript
// ä» @tabler/icons-vue å¯¼å…¥å›¾æ ‡
import {
  IconTable,           // è¡¨æ ¼
  IconDatabase,        // æ•°æ®åº“
  IconClipboard,       // å‰ªè´´æ¿
  IconDownload,        // ä¸‹è½½
  IconCheckCircle,     // æˆåŠŸ
  IconAlertCircle,     // è­¦å‘Š
  IconInfoCircle,      // ä¿¡æ¯
  IconAward,           // å¥–é¡¹
  IconLink,            // é“¾æ¥
  IconChart,           // å›¾è¡¨
} from '@tabler/icons-vue'
```

### 5. å“åº”å¼æ–­ç‚¹

```css
/* å“åº”å¼å¸ƒå±€ */
@media (max-width: 1400px) {
  .feishu-import-container {
    max-width: 100%;
    padding: 16px;
  }
}

@media (max-width: 768px) {
  .field-mapping-editor {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto;
  }
  
  .stats-overview {
    grid-template-columns: 1fr 1fr !important;
  }
}
```

---

## æ•°æ®åº“è®¾è®¡

### æ–°å¢è¡¨ç»“æ„

```sql
-- 1. é£ä¹¦åº”ç”¨é…ç½®è¡¨
CREATE TABLE feishu_configs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    app_id VARCHAR(100) NOT NULL COMMENT 'é£ä¹¦åº”ç”¨ID',
    app_secret VARCHAR(500) NOT NULL COMMENT 'é£ä¹¦åº”ç”¨å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰',
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é£ä¹¦åº”ç”¨é…ç½®è¡¨';

-- 2. å­—æ®µæ˜ å°„é…ç½®è¡¨
CREATE TABLE feishu_field_mappings (
    id INT PRIMARY KEY AUTO_INCREMENT,
    config_id INT NOT NULL COMMENT 'å…³è”çš„é…ç½®ID',
    name VARCHAR(100) NOT NULL COMMENT 'æ˜ å°„æ¨¡æ¿åç§°',
    feishu_field_name VARCHAR(100) NOT NULL COMMENT 'é£ä¹¦å­—æ®µå',
    db_field_name VARCHAR(50) NOT NULL COMMENT 'æ•°æ®åº“å­—æ®µå',
    transform_rule JSON COMMENT 'è½¬æ¢è§„åˆ™ï¼ˆJSONæ ¼å¼ï¼‰',
    is_required TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦å¿…å¡«',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (config_id) REFERENCES feishu_configs(id) ON DELETE CASCADE,
    INDEX idx_config (config_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å­—æ®µæ˜ å°„é…ç½®è¡¨';

-- 3. é£ä¹¦å¯¼å…¥å†å²è¡¨
CREATE TABLE feishu_import_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    operator_id INT NOT NULL COMMENT 'æ“ä½œè€…ID',
    operator_role ENUM('admin', 'student') NOT NULL COMMENT 'æ“ä½œè€…è§’è‰²',
    app_token VARCHAR(100) COMMENT 'å¤šç»´è¡¨æ ¼app_token',
    table_id VARCHAR(100) COMMENT 'æ•°æ®è¡¨table_id',
    total_records INT DEFAULT 0 COMMENT 'æ€»è®°å½•æ•°',
    success_count INT DEFAULT 0 COMMENT 'æˆåŠŸå¯¼å…¥æ•°',
    failed_count INT DEFAULT 0 COMMENT 'å¤±è´¥æ•°',
    error_details JSON COMMENT 'é”™è¯¯è¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_operator (operator_id, operator_role),
    INDEX idx_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é£ä¹¦å¯¼å…¥å†å²è®°å½•è¡¨';
```

### ä¿®æ”¹ç°æœ‰è¡¨

```sql
-- åœ¨æˆæœè¡¨ä¸­æ·»åŠ å¯é€‰å­—æ®µï¼ˆç”¨äºé£ä¹¦é™„ä»¶å¤±è´¥é‡è¯•ï¼‰
ALTER TABLE biz_achievements 
ADD COLUMN feishu_attachment_token VARCHAR(200) DEFAULT NULL 
COMMENT 'é£ä¹¦é™„ä»¶ä¸´æ—¶tokenï¼Œç”¨äºå¤±è´¥é‡è¯•';
```

---

## å®Œæ•´å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€ç¯å¢ƒå‡†å¤‡ï¼ˆ1å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å®‰è£…é£ä¹¦SDKï¼š`pip install lark-oapi>=1.2.0`
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆæ‰§è¡Œä¸Šè¿°SQLè„šæœ¬ï¼‰
- [ ] åœ¨é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
- [ ] é…ç½®åº”ç”¨æƒé™å¹¶å‘å¸ƒ
- [ ] è·å–App IDå’ŒApp Secret

**éªŒæ”¶æ ‡å‡†ï¼š**
- åº”ç”¨å‘å¸ƒæˆåŠŸï¼Œå…¨å‘˜å¯è§
- æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸï¼Œæ— é”™è¯¯
- èƒ½æˆåŠŸè°ƒç”¨é£ä¹¦APIè·å–tenant_access_token

---

### Phase 2: åç«¯æ ¸å¿ƒæœåŠ¡å¼€å‘ï¼ˆ3-4å¤©ï¼‰

#### Day 1: é£ä¹¦APIæœåŠ¡å±‚
**æ–‡ä»¶ï¼š** `backend/services/feishu_integration.py`

```python
from lark_oapi import Client
from lark_oapi.api.bitable.v1 import *

class FeishuService:
    def __init__(self, app_id: str, app_secret: str):
        self.client = Client.builder()
            .app_id(app_id)
            .app_secret(app_secret)
            .build()
    
    async def get_table_records(self, app_token: str, table_id: str):
        # å®ç°è®°å½•è¯»å–
        pass
    
    async def download_file(self, file_token: str):
        # å®ç°æ–‡ä»¶ä¸‹è½½
        pass
```

**éªŒæ”¶æ ‡å‡†ï¼š**
- èƒ½æˆåŠŸè¯»å–å¤šç»´è¡¨æ ¼è®°å½•
- èƒ½ä¸‹è½½é™„ä»¶åˆ°æœ¬åœ°

#### Day 2: å­—æ®µæ˜ å°„å¼•æ“
**æ–‡ä»¶ï¼š** `backend/services/data_mapper.py`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- æ•™å¸ˆå§“åâ†’IDè½¬æ¢
- æšä¸¾å€¼æ˜ å°„
- æ—¥æœŸæ ¼å¼è§£æ
- æ•°æ®æ ¡éªŒ

**éªŒæ”¶æ ‡å‡†ï¼š**
- æ‰€æœ‰è½¬æ¢è§„åˆ™æ­£å¸¸å·¥ä½œ
- æ ¡éªŒé”™è¯¯ä¿¡æ¯æ¸…æ™°å‡†ç¡®

#### Day 3: è·¯ç”±æ¥å£å¼€å‘
**æ–‡ä»¶ï¼š** `backend/routers/feishu.py`

å®ç°æ‰€æœ‰APIç«¯ç‚¹ï¼ˆè§ä¸Šæ–‡æ¥å£æ¸…å•ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼š**
- æ‰€æœ‰æ¥å£æ­£å¸¸å“åº”
- Postmanæµ‹è¯•é€šè¿‡

#### Day 4: æ–‡ä»¶ä¸‹è½½æœåŠ¡
**æ–‡ä»¶ï¼š** `backend/services/feishu_file_downloader.py`

**éªŒæ”¶æ ‡å‡†ï¼š**
- é™„ä»¶ä¸‹è½½æˆåŠŸç‡>95%
- å¤±è´¥æƒ…å†µæ­£ç¡®ä¿å­˜tokenç”¨äºé‡è¯•

---

### Phase 3: å‰ç«¯ç•Œé¢å¼€å‘ï¼ˆ4-5å¤©ï¼‰

#### Day 1-2: ç®¡ç†ç«¯é…ç½®é¡µé¢
**æ–‡ä»¶ï¼š**
- `FeishuConfig.vue`
- `FieldMappingEditor.vue`

**éªŒæ”¶æ ‡å‡†ï¼š**
- é…ç½®ä¿å­˜æˆåŠŸ
- æ˜ å°„å…³ç³»å¯è§†åŒ–å±•ç¤º

#### Day 3-4: å¯¼å…¥ä¸»ç•Œé¢
**æ–‡ä»¶ï¼š** `FeishuImport.vue`

**éªŒæ”¶æ ‡å‡†ï¼š**
- æ­¥éª¤æµç¨‹æ¸…æ™°
- æ•°æ®é¢„è§ˆå‡†ç¡®
- é”™è¯¯æç¤ºå‹å¥½

#### Day 5: å­¦ç”Ÿç«¯å¿«æ·å¯¼å…¥
**æ–‡ä»¶ï¼š** `FeishuQuickImport.vue`

**éªŒæ”¶æ ‡å‡†ï¼š**
- é“¾æ¥ç²˜è´´è‡ªåŠ¨è§£æ
- åªæ˜¾ç¤ºå½“å‰å­¦ç”Ÿçš„è®°å½•

---

### Phase 4: é›†æˆæµ‹è¯•ï¼ˆ2å¤©ï¼‰

#### æµ‹è¯•ç”¨ä¾‹

1. **é…ç½®æµ‹è¯•**
   - æ­£ç¡®çš„å‡­è¯å¯ä»¥ä¿å­˜
   - é”™è¯¯çš„å‡­è¯æç¤ºå¤±è´¥

2. **å­—æ®µæ˜ å°„æµ‹è¯•**
   - æšä¸¾æ˜ å°„æ­£ç¡®
   - æ•™å¸ˆå§“ååŒ¹é…å‡†ç¡®
   - æ—¥æœŸæ ¼å¼è§£ææ­£ç¡®

3. **å¯¼å…¥æµç¨‹æµ‹è¯•**
   - é¢„è§ˆæ•°æ®å‡†ç¡®
   - æ ¡éªŒé”™è¯¯æ ‡è®°æ¸…æ™°
   - å¯¼å…¥æˆåŠŸåæ•°æ®å®Œæ•´

4. **é™„ä»¶ä¸‹è½½æµ‹è¯•**
   - æ­£å¸¸æƒ…å†µä¸‹è½½åˆ°æœ¬åœ°
   - å¤±è´¥æƒ…å†µä¿ç•™token

5. **æƒé™æµ‹è¯•**
   - å­¦ç”Ÿåªèƒ½å¯¼å…¥è‡ªå·±çš„æ•°æ®
   - ç®¡ç†å‘˜å¯ä»¥å¯¼å…¥æ‰€æœ‰æ•°æ®

---

### Phase 5: ä¸Šçº¿éƒ¨ç½²ï¼ˆ1å¤©ï¼‰

**éƒ¨ç½²æ£€æŸ¥æ¸…å•ï¼š**
- [ ] ç¯å¢ƒå˜é‡é…ç½®ï¼ˆApp ID/Secretï¼‰
- [ ] æ•°æ®åº“è¿ç§»æ‰§è¡Œ
- [ ] é™æ€èµ„æºç¼–è¯‘
- [ ] Nginxé…ç½®æ›´æ–°
- [ ] SSLè¯ä¹¦é…ç½®ï¼ˆHTTPSå¿…éœ€ï¼‰
- [ ] åå°ä»»åŠ¡å¯åŠ¨ï¼ˆé‡è¯•ä¸‹è½½ï¼‰
- [ ] ç›‘æ§å‘Šè­¦é…ç½®

**ä¸Šçº¿åéªŒè¯ï¼š**
- [ ] æµ‹è¯•è´¦å·å¯¼å…¥æˆåŠŸ
- [ ] æ—¥å¿—æ— å¼‚å¸¸
- [ ] æ€§èƒ½ç›‘æ§æ­£å¸¸

---

## é™„å½•ï¼šé£ä¹¦è¡¨æ ¼æ¨¡æ¿ç¤ºä¾‹

### æ ‡å‡†æˆæœæ”¶é›†è¡¨æ¨¡æ¿

**è¡¨æ ¼åç§°ï¼š** `å­¦ç”Ÿæˆæœæ•°æ®æ”¶é›†è¡¨_2024ç§‹å­£å­¦æœŸ`

**åˆ—é…ç½®ï¼š**

| åˆ—å | å­—æ®µç±»å‹ | é…ç½®é¡¹ | ç¤ºä¾‹å€¼ |
|-----|---------|--------|--------|
| å­¦ç”Ÿå§“å | å•è¡Œæ–‡æœ¬ | å¿…å¡« | å¼ ä¸‰ |
| å­¦å· | å•è¡Œæ–‡æœ¬ | å¯é€‰ | 2021001001 |
| æˆæœæ ‡é¢˜ | å•è¡Œæ–‡æœ¬ | å¿…å¡« | 2024å¹´å…¨å›½å¤§å­¦ç”Ÿæ•°å­¦å»ºæ¨¡ç«èµ› |
| è·å¥–æ—¥æœŸ | æ—¥æœŸ | å¿…å¡«ï¼Œæ ¼å¼ï¼šYYYY-MM-DD | 2024-09-15 |
| æˆæœç±»åˆ« | å•é€‰ | é€‰é¡¹ï¼šç«èµ›ç±»ã€ç§‘ç ”ç±»ã€é¡¹ç›®ç±»ã€è®ºæ–‡ç±»ã€ä¸“åˆ©ç±»ã€è¯ä¹¦ç±» | ç«èµ›ç±» |
| å¥–é¡¹ç­‰çº§ | å•é€‰ | é€‰é¡¹ï¼šå›½å®¶çº§ã€çœéƒ¨çº§ã€æ ¡çº§ã€é™¢çº§ | å›½å®¶çº§ |
| å…·ä½“å¥–é¡¹ | å•è¡Œæ–‡æœ¬ | å¿…å¡« | ä¸€ç­‰å¥– |
| æŒ‡å¯¼æ•™å¸ˆ | å•è¡Œæ–‡æœ¬ | ç”¨é¡¿å·åˆ†éš”å¤šä½æ•™å¸ˆ | æè€å¸ˆã€ç‹è€å¸ˆ |
| è¯ä¹¦é™„ä»¶ | é™„ä»¶ | æ”¯æŒJPG/PNGï¼Œå•ä¸ªä¸è¶…è¿‡10MB | [ä¸Šä¼ å›¾ç‰‡] |
| é¢å‘å•ä½ | å•è¡Œæ–‡æœ¬ | å¯é€‰ | ä¸­å›½æ•°å­¦ä¼š |
| è¯ä¹¦ç¼–å· | å•è¡Œæ–‡æœ¬ | å¯é€‰ | 2024-CUMCM-12345 |
| å¤‡æ³¨ | å¤šè¡Œæ–‡æœ¬ | å¯é€‰ | å…¶ä»–è¯´æ˜ |

**å¡«å†™è¯´æ˜ï¼ˆæ’å…¥åˆ°è¡¨æ ¼é¡¶éƒ¨ï¼‰ï¼š**

```
ğŸ“Œ å¡«å†™æŒ‡å—ï¼š
1. è¯·ç¡®ä¿"å­¦ç”Ÿå§“å"ä¸å¹³å°æ³¨å†Œå§“åå®Œå…¨ä¸€è‡´
2. æ—¥æœŸæ ¼å¼å¿…é¡»ä¸ºï¼š2024-09-15ï¼ˆå¹´-æœˆ-æ—¥ï¼‰
3. æˆæœç±»åˆ«è¯·ä¸¥æ ¼ä»ä¸‹æ‹‰é€‰é¡¹ä¸­é€‰æ‹©
4. æŒ‡å¯¼æ•™å¸ˆå¦‚æœ‰å¤šä½ï¼Œç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰åˆ†éš”
5. è¯ä¹¦é™„ä»¶å»ºè®®ä¸Šä¼ æ¸…æ™°çš„JPGæˆ–PNGæ ¼å¼å›¾ç‰‡
6. å¡«å†™å®Œæˆåé€šçŸ¥ç®¡ç†å‘˜è¿›è¡Œå¯¼å…¥æ“ä½œ
```

**ä¸‹è½½é“¾æ¥ï¼š** *(ç‚¹å‡»"åˆ›å»ºå‰¯æœ¬"åˆ°ä½ çš„é£ä¹¦ç©ºé—´)*  
`https://xxx.feishu.cn/base/xxx?table=xxx`

---

## æ€»ç»“

æœ¬æ–¹æ¡ˆé€šè¿‡é£ä¹¦å®˜æ–¹SDKå®ç°äº†ä¸å¤šç»´è¡¨æ ¼çš„æ·±åº¦é›†æˆï¼Œé‡‡ç”¨æ··åˆæ™ºèƒ½ä¸‹è½½ç­–ç•¥ç¡®ä¿è¯ä¹¦å›¾ç‰‡çš„å¯é å­˜å‚¨ï¼Œé€šè¿‡çµæ´»çš„å­—æ®µæ˜ å°„é…ç½®é€‚åº”ä¸åŒçš„æ•°æ®æºæ ¼å¼ã€‚æ•´ä¸ªæ–¹æ¡ˆç¬¦åˆç°ä»£åŒ–UI/UXè®¾è®¡è§„èŒƒï¼Œæä¾›äº†æ¸…æ™°çš„æ“ä½œæµç¨‹å’Œå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚

**é¢„æœŸæ”¶ç›Šï¼š**
- âš¡ æ‰¹é‡å¯¼å…¥æ•ˆç‡æå‡80%ä»¥ä¸Š
- ğŸ¯ æ•°æ®å‡†ç¡®ç‡æå‡è‡³95%ä»¥ä¸Šï¼ˆé¢„æ ¡éªŒæœºåˆ¶ï¼‰
- ğŸ”’ è¯ä¹¦å›¾ç‰‡100%ä¿å­˜åœ¨æœ¬åœ°æœåŠ¡å™¨
- ğŸ“Š å®Œæ•´çš„å¯¼å…¥å†å²è¿½æº¯èƒ½åŠ›

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š**
1. æŒ‰Phaseé¡ºåºå¼€å§‹å®æ–½
2. æ¯ä¸ªPhaseå®Œæˆåè¿›è¡Œé˜¶æ®µæ€§éªŒæ”¶
3. æ”¶é›†ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æ›´æ–°æ—¥æœŸï¼š** 2026-02-06  
**ç»´æŠ¤è€…ï¼š** é¡¹ç›®å¼€å‘ç»„
