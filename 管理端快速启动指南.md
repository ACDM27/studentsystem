# 管理端快速启动指南

## 🚀 快速开始

### 1. 准备工作

确保您已经：
- ✅ 安装了Node.js（建议v18+）
- ✅ 后端服务正在运行（http://localhost:8000）
- ✅ MySQL数据库已连接
- ✅ 数据库中有管理员账号

### 2. 启动前端

```powershell
# 进入前端目录
cd d:\student_system\frontend

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

### 3. 访问管理端

浏览器打开：**http://localhost:5173/admin/login**

### 4. 登录

使用管理员账号登录：
- 用户名：admin（或您的管理员用户名）
- 密码：您的密码
- ⚠️ 必须是 `role='admin'` 的用户

---

## 📋 创建管理员账号（如果还没有）

### 方法1：使用Python脚本

```python
# 在backend目录下创建 create_admin.py
from passlib.context import CryptContext
from database import SessionLocal
from models import SysUser, UserRole

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def create_admin():
    db = SessionLocal()
    try:
        # 检查是否已存在
        existing = db.query(SysUser).filter(SysUser.username == "admin").first()
        if existing:
            print("管理员账号已存在")
            return
        
        # 创建管理员
        hashed_password = pwd_context.hash("admin123")  # 修改为您的密码
        admin_user = SysUser(
            username="admin",
            password_hash=hashed_password,
            role=UserRole.ADMIN
        )
        db.add(admin_user)
        db.commit()
        print("管理员账号创建成功！")
        print("用户名: admin")
        print("密码: admin123")
    except Exception as e:
        print(f"创建失败: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    create_admin()
```

运行脚本：
```powershell
cd d:\student_system\backend
python create_admin.py
```

### 方法2：使用SQL（不推荐，密码需手动加密）

```sql
-- 1. 先用Python生成密码哈希
-- python -c "from passlib.context import CryptContext; print(CryptContext(schemes=['bcrypt']).hash('admin123'))"

-- 2. 插入用户
INSERT INTO sys_users (username, password_hash, role, created_at)
VALUES ('admin', '$2b$12$...', 'admin', NOW());
```

---

## 🎯 主要功能路由

| 功能 | 路由 | 说明 |
|------|------|------|
| 管理员登录 | `/admin/login` | 独立的管理端登录页 |
| 管理端首页 | `/admin/dashboard` | 数据概览和快捷操作 |
| 成果审核 | `/admin/achievements` | 成果列表、筛选、审核 |

---

## 📊 使用流程

### 审核成果流程

1. **登录管理端** → 访问 `/admin/login` 输入管理员账号
   
2. **查看成果列表** → 点击侧边栏"成果审核"
   
3. **筛选待审核成果** → 选择状态"待审核"，点击搜索
   
4. **查看详情** → 点击某个成果的"查看详情"按钮
   - 查看学生信息
   - 查看OCR识别数据
   - 查看证书图片（可放大）
   
5. **审核操作** → 点击"审核"按钮
   - 选择"批准通过"或"拒绝"
   - 如果拒绝，必须填写原因
   - 点击"确认提交"
   
6. **查看结果** → 刷新列表，成果状态已更新

---

## ✅ 快速验证

### 测试1：登录功能
```
1. 访问 http://localhost:3000/admin/login
2. 输入管理员账号和密码
3. 点击"登录"
✅ 期望：成功跳转到 /admin/dashboard
```

### 测试2：权限控制
```
1. 使用学生账号登录管理端
✅ 期望：提示"您不是管理员，无法访问管理端"

2. 访问 /admin/dashboard 但未登录
✅ 期望：自动跳转到 /admin/login
```

### 测试3：成果审核
```
1. 进入成果列表页
✅ 期望：显示所有成果

2. 筛选"待审核"状态
✅ 期望：只显示pending状态的成果

3. 点击"审核"，选择"批准"
✅ 期望：成果状态变为"已通过"
```

### 测试4：数据同步
```
1. 学生端提交新成果
2. 管理端刷新列表
✅ 期望：新成果出现在待审核列表

3. 管理端批准成果
4. 学生端查看成果列表
✅ 期望：状态显示为"已通过"
```

---

## ⚠️ 常见问题

### Q1: 登录后提示"您不是管理员"？
**A:** 检查数据库中该用户的 `role` 字段是否为 `'admin'`

### Q2: 页面空白或404？
**A:** 
- 确保前端开发服务器正在运行
- 检查浏览器控制台是否有错误
- 确认路由路径正确

### Q3: 看不到成果列表？
**A:**
- 确保后端服务正在运行（http://localhost:8000）
- 检查网络请求是否成功（F12 → Network）
- 确认数据库中有成果数据

### Q4: 审核提交失败？
**A:**
- 拒绝时必须填写原因
- 检查网络请求错误信息
- 查看后端日志

---

## 📞 获取帮助

如遇到问题：

1. **查看浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签的错误信息

2. **查看网络请求**
   - 开发者工具 → Network标签
   - 查看API请求是否成功
   - 检查响应状态码和返回内容

3. **查看后端日志**
   - 后端控制台会显示所有API请求
   - 查看是否有错误信息

4. **检查数据库**
   ```sql
   -- 检查管理员账号
   SELECT * FROM sys_users WHERE role='admin';
   
   -- 检查成果数据
   SELECT * FROM biz_achievements LIMIT 10;
   ```

---

**祝您使用愉快！** 🎉
