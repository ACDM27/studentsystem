# å‰ç«¯å¼€å‘å®æˆ˜æŒ‡å—

## ğŸ¯ ç›®æ ‡è¯»è€…

æœ¬æ–‡æ¡£é¢å‘éœ€è¦å¯¹æ¥æ­¤åç«¯APIçš„å‰ç«¯å¼€å‘è€…ï¼Œæä¾›å®ç”¨çš„ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

**åˆ›å»º `.env.local` æ–‡ä»¶**:
```env
VUE_APP_API_BASE_URL=http://localhost:8000
```

---

### 2. å®‰è£…ä¾èµ–

```bash
npm install axios
npm install pinia  # çŠ¶æ€ç®¡ç†
npm install element-plus  # UIç»„ä»¶åº“(å¯é€‰)
npm install dayjs  # æ—¥æœŸå¤„ç†
```

---

## ğŸ“¦ ä»£ç ç»“æ„å»ºè®®

```
src/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.js              # axiosé…ç½®
â”‚   â”œâ”€â”€ auth.js               # è®¤è¯ç›¸å…³API
â”‚   â”œâ”€â”€ student.js            # å­¦ç”Ÿç«¯API
â”‚   â”œâ”€â”€ admin.js              # ç®¡ç†å‘˜API
â”‚   â””â”€â”€ common.js             # å…¬å…±API
â”‚
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ user.js               # ç”¨æˆ·çŠ¶æ€
â”‚   â””â”€â”€ achievement.js        # æˆæœçŠ¶æ€
â”‚
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.js              # è·¯ç”±é…ç½®ï¼ˆå«æƒé™æ§åˆ¶ï¼‰
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ auth.js               # Tokenç®¡ç†
â”‚   â””â”€â”€ request.js            # è¯·æ±‚å°è£…
â”‚
â””â”€â”€ views/
    â”œâ”€â”€ Login.vue             # ç™»å½•é¡µ
    â”œâ”€â”€ student/
    â”‚   â”œâ”€â”€ AchievementSubmit.vue    # æˆæœæäº¤
    â”‚   â”œâ”€â”€ AchievementList.vue      # æˆ‘çš„æˆæœ
    â”‚   â””â”€â”€ AIChat.vue               # AIå¯¹è¯
    â””â”€â”€ admin/
        â””â”€â”€ AchievementReview.vue    # æˆæœå®¡æ ¸
```

---

## ğŸ”§ æ ¸å¿ƒä»£ç å®ç°

### 1. Axiosé…ç½® (`api/index.js`)

```javascript
import axios from 'axios';
import { ElMessage } from 'element-plus';
import router from '@/router';

// åˆ›å»ºaxioså®ä¾‹
const request = axios.create({
  baseURL: process.env.VUE_APP_API_BASE_URL || 'http://localhost:8000',
  timeout: 30000
});

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    // æ·»åŠ Token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  error => {
    console.error('è¯·æ±‚é”™è¯¯:', error);
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => {
    const { code, msg, data } = response.data;
    
    if (code === 200) {
      return data;  // ç›´æ¥è¿”å›dataéƒ¨åˆ†
    } else {
      // ä¸šåŠ¡é”™è¯¯
      ElMessage.error(msg || 'è¯·æ±‚å¤±è´¥');
      return Promise.reject(new Error(msg || 'è¯·æ±‚å¤±è´¥'));
    }
  },
  error => {
    // HTTPé”™è¯¯
    if (error.response) {
      const { status, data } = error.response;
      
      switch (status) {
        case 401:
          // Tokenè¿‡æœŸæˆ–æœªç™»å½•
          ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
          localStorage.removeItem('token');
          localStorage.removeItem('userInfo');
          router.push('/login');
          break;
          
        case 403:
          ElMessage.error('æƒé™ä¸è¶³');
          break;
          
        case 404:
          ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');
          break;
          
        case 500:
          ElMessage.error(data?.msg || 'æœåŠ¡å™¨é”™è¯¯');
          break;
          
        default:
          ElMessage.error(data?.msg || 'è¯·æ±‚å¤±è´¥');
      }
    } else {
      ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    }
    
    return Promise.reject(error);
  }
);

export default request;
```

---

### 2. APIæ¨¡å—åŒ–

#### `api/auth.js` - è®¤è¯ç›¸å…³

```javascript
import request from './index';

/**
 * ç”¨æˆ·ç™»å½•
 * @param {string} username - ç”¨æˆ·å
 * @param {string} password - å¯†ç 
 * @returns {Promise<{token: string, userInfo: object}>}
 */
export function login(username, password) {
  return request({
    url: '/api/v1/auth/login',
    method: 'post',
    data: { username, password }
  });
}
```

---

#### `api/common.js` - å…¬å…±API

```javascript
import request from './index';

/**
 * è·å–æ•™å¸ˆåˆ—è¡¨
 * @returns {Promise<Array<{id: number, name: string, department: string}>>}
 */
export function getTeachers() {
  return request({
    url: '/api/v1/common/teachers',
    method: 'get'
  });
}

/**
 * ä¸Šä¼ æ–‡ä»¶ï¼ˆé€šç”¨ï¼‰
 * @param {File} file - æ–‡ä»¶å¯¹è±¡
 * @returns {Promise<{url: string}>}
 */
export function uploadFile(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  return request({
    url: '/api/v1/common/upload',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    }
  });
}
```

---

#### `api/student.js` - å­¦ç”Ÿç«¯API

```javascript
import request from './index';

/**
 * è¯ä¹¦OCRè¯†åˆ«ï¼ˆæ­¥éª¤1ï¼‰
 * @param {File} file - è¯ä¹¦å›¾ç‰‡æ–‡ä»¶
 * @returns {Promise<{recognized_data: object, file_url: string, file_info: object, ai_metadata: object}>}
 */
export function recognizeCertificate(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  return request({
    url: '/api/v1/student/ocr/recognize',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    },
    timeout: 60000  // OCRå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´
  });
}

/**
 * æäº¤æˆæœï¼ˆæ­¥éª¤2ï¼‰
 * @param {object} data - æˆæœæ•°æ®
 * @param {number} data.teacher_id - æ•™å¸ˆID
 * @param {string} data.title - æˆæœæ ‡é¢˜
 * @param {string} data.type - æˆæœç±»å‹
 * @param {object} [data.content_json] - è¯¦ç»†ä¿¡æ¯
 * @param {string} [data.evidence_url] - è¯ä¹¦URL
 * @returns {Promise<{id: number}>}
 */
export function submitAchievement(data) {
  return request({
    url: '/api/v1/student/achievements',
    method: 'post',
    data
  });
}

/**
 * è·å–æˆ‘çš„æˆæœåˆ—è¡¨
 * @param {string} [status] - çŠ¶æ€ç­›é€‰ pending/approved/rejected
 * @returns {Promise<Array>}
 */
export function getMyAchievements(status = null) {
  return request({
    url: '/api/v1/student/achievements',
    method: 'get',
    params: status ? { status } : {}
  });
}

/**
 * è·å–æˆ‘çš„è¯ä¹¦åˆ—è¡¨
 * @returns {Promise<{certificates: Array, total: number}>}
 */
export function getMyCertificates() {
  return request({
    url: '/api/v1/student/certificates',
    method: 'get'
  });
}

/**
 * è·å–å­¦ç”Ÿç”»åƒ
 * @returns {Promise<object>}
 */
export function getPersona() {
  return request({
    url: '/api/v1/student/persona',
    method: 'get'
  });
}

/**
 * AIå¯¹è¯
 * @param {string|null} sessionId - ä¼šè¯IDï¼ˆæ–°ä¼šè¯ä¼ nullï¼‰
 * @param {string} message - æ¶ˆæ¯å†…å®¹
 * @returns {Promise<{session_id: string, message: string}>}
 */
export function chatWithAI(sessionId, message) {
  return request({
    url: '/api/v1/student/ai/chat',
    method: 'post',
    data: {
      session_id: sessionId,
      message
    }
  });
}
```

---

#### `api/admin.js` - ç®¡ç†å‘˜API

```javascript
import request from './index';

/**
 * è·å–æˆæœå®¡æ ¸åˆ—è¡¨
 * @param {object} params - æŸ¥è¯¢å‚æ•°
 * @param {string} [params.status] - çŠ¶æ€ç­›é€‰
 * @param {string} [params.student_name] - å­¦ç”Ÿå§“åæœç´¢
 * @param {number} [params.page=1] - é¡µç 
 * @param {number} [params.page_size=10] - æ¯é¡µæ•°é‡
 * @returns {Promise<{list: Array, total: number}>}
 */
export function getAchievementsForReview(params) {
  return request({
    url: '/api/v1/admin/achievements',
    method: 'get',
    params
  });
}

/**
 * å®¡æ ¸æˆæœ
 * @param {number} achievementId - æˆæœID
 * @param {string} action - æ“ä½œ approve/reject
 * @param {string} [comment] - å®¡æ ¸æ„è§ï¼ˆæ‹’ç»æ—¶å¿…å¡«ï¼‰
 * @returns {Promise<void>}
 */
export function auditAchievement(achievementId, action, comment = null) {
  return request({
    url: `/api/v1/admin/achievements/${achievementId}/audit`,
    method: 'patch',
    data: { action, comment }
  });
}
```

---

### 3. çŠ¶æ€ç®¡ç† (Pinia)

#### `stores/user.js`

```javascript
import { defineStore } from 'pinia';
import { login as loginAPI } from '@/api/auth';
import router from '@/router';

export const useUserStore = defineStore('user', {
  state: () => ({
    token: localStorage.getItem('token') || '',
    userInfo: JSON.parse(localStorage.getItem('userInfo') || 'null')
  }),
  
  getters: {
    isLoggedIn: (state) => !!state.token,
    isAdmin: (state) => state.userInfo?.role === 'admin',
    isStudent: (state) => state.userInfo?.role === 'student',
    userName: (state) => state.userInfo?.name || ''
  },
  
  actions: {
    async login(username, password) {
      try {
        const data = await loginAPI(username, password);
        
        // ä¿å­˜Tokenå’Œç”¨æˆ·ä¿¡æ¯
        this.token = data.token;
        this.userInfo = data.userInfo;
        
        localStorage.setItem('token', data.token);
        localStorage.setItem('userInfo', JSON.stringify(data.userInfo));
        
        // æ ¹æ®è§’è‰²è·³è½¬
        if (data.userInfo.role === 'admin') {
          router.push('/admin/achievements');
        } else {
          router.push('/student/achievements');
        }
        
        return data;
      } catch (error) {
        throw error;
      }
    },
    
    logout() {
      this.token = '';
      this.userInfo = null;
      
      localStorage.removeItem('token');
      localStorage.removeItem('userInfo');
      
      router.push('/login');
    }
  }
});
```

---

### 4. è·¯ç”±é…ç½® (`router/index.js`)

```javascript
import { createRouter, createWebHistory } from 'vue-router';
import { useUserStore } from '@/stores/user';

const routes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/Login.vue')
  },
  {
    path: '/student',
    meta: { requiresAuth: true, role: 'student' },
    children: [
      {
        path: 'achievements',
        name: 'StudentAchievements',
        component: () => import('@/views/student/AchievementList.vue')
      },
      {
        path: 'submit',
        name: 'SubmitAchievement',
        component: () => import('@/views/student/AchievementSubmit.vue')
      },
      {
        path: 'chat',
        name: 'AIChat',
        component: () => import('@/views/student/AIChat.vue')
      }
    ]
  },
  {
    path: '/admin',
    meta: { requiresAuth: true, role: 'admin' },
    children: [
      {
        path: 'achievements',
        name: 'AdminAchievements',
        component: () => import('@/views/admin/AchievementReview.vue')
      }
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const userStore = useUserStore();
  
  if (to.meta.requiresAuth) {
    if (!userStore.isLoggedIn) {
      // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
      next('/login');
    } else if (to.meta.role && userStore.userInfo?.role !== to.meta.role) {
      // è§’è‰²ä¸åŒ¹é…
      ElMessage.error('æƒé™ä¸è¶³');
      next('/403');
    } else {
      next();
    }
  } else {
    next();
  }
});

export default router;
```

---

## ğŸ“„ é¡µé¢ç»„ä»¶å®æˆ˜

### 1. ç™»å½•é¡µ (`Login.vue`)

```vue
<template>
  <div class="login-container">
    <el-card class="login-card">
      <h2>å­¦ç”Ÿä¿¡æ¯æœåŠ¡å¹³å°</h2>
      
      <el-form :model="form" :rules="rules" ref="formRef">
        <el-form-item prop="username">
          <el-input
            v-model="form.username"
            placeholder="ç”¨æˆ·å"
            prefix-icon="User"
          />
        </el-form-item>
        
        <el-form-item prop="password">
          <el-input
            v-model="form.password"
            type="password"
            placeholder="å¯†ç "
            prefix-icon="Lock"
            @keyup.enter="handleLogin"
          />
        </el-form-item>
        
        <el-button
          type="primary"
          :loading="loading"
          @click="handleLogin"
          style="width: 100%"
        >
          ç™»å½•
        </el-button>
      </el-form>
      
      <div class="tips">
        <p>æµ‹è¯•è´¦å·ï¼š</p>
        <p>å­¦ç”Ÿ: student001 / password123</p>
        <p>ç®¡ç†å‘˜: admin / admin123</p>
      </div>
    </el-card>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';
import { useUserStore } from '@/stores/user';
import { ElMessage } from 'element-plus';

const userStore = useUserStore();
const formRef = ref(null);
const loading = ref(false);

const form = reactive({
  username: '',
  password: ''
});

const rules = {
  username: [
    { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' }
  ],
  password: [
    { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' }
  ]
};

const handleLogin = async () => {
  try {
    await formRef.value.validate();
    
    loading.value = true;
    await userStore.login(form.username, form.password);
    
    ElMessage.success('ç™»å½•æˆåŠŸ');
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};
</script>

<style scoped>
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-card {
  width: 400px;
  padding: 20px;
}

.tips {
  margin-top: 20px;
  font-size: 12px;
  color: #999;
}
</style>
```

---

### 2. æˆæœæäº¤é¡µ (`AchievementSubmit.vue`)

```vue
<template>
  <div class="submit-container">
    <el-card>
      <h2>æäº¤æˆæœ</h2>
      
      <!-- æ­¥éª¤1: ä¸Šä¼ è¯ä¹¦ -->
      <el-steps :active="currentStep" align-center>
        <el-step title="ä¸Šä¼ è¯ä¹¦" />
        <el-step title="ç¡®è®¤ä¿¡æ¯" />
        <el-step title="å®Œæˆ" />
      </el-steps>
      
      <!-- æ­¥éª¤1: è¯ä¹¦ä¸Šä¼  -->
      <div v-if="currentStep === 0" class="step-content">
        <el-upload
          drag
          :auto-upload="false"
          :on-change="handleFileChange"
          :limit="1"
          accept="image/*"
        >
          <el-icon class="el-icon--upload"><upload-filled /></el-icon>
          <div class="el-upload__text">
            æ‹–æ‹½æˆ– <em>ç‚¹å‡»ä¸Šä¼ è¯ä¹¦å›¾ç‰‡</em>
          </div>
        </el-upload>
        
        <el-button
          type="primary"
          :loading="recognizing"
          :disabled="!selectedFile"
          @click="recognizeCertificate"
          style="margin-top: 20px; width: 100%"
        >
          {{ recognizing ? 'AIè¯†åˆ«ä¸­...' : 'å¼€å§‹è¯†åˆ«' }}
        </el-button>
      </div>
      
      <!-- æ­¥éª¤2: ç¡®è®¤ä¿¡æ¯ -->
      <div v-if="currentStep === 1" class="step-content">
        <el-form :model="achievementForm" label-width="100px">
          <el-form-item label="æˆæœæ ‡é¢˜">
            <el-input v-model="achievementForm.title" />
          </el-form-item>
          
          <el-form-item label="æˆæœç±»å‹">
            <el-select v-model="achievementForm.type" style="width: 100%">
              <el-option label="å­¦ç§‘ç«èµ›" value="competition" />
              <el-option label="è®ºæ–‡å‘è¡¨" value="paper" />
              <el-option label="ä¸“åˆ©" value="patent" />
              <el-option label="é¡¹ç›®" value="project" />
              <el-option label="èŒä¸šè¯ä¹¦" value="certificate" />
            </el-select>
          </el-form-item>
          
          <el-form-item label="æŒ‡å¯¼æ•™å¸ˆ">
            <el-select v-model="achievementForm.teacher_id" style="width: 100%">
              <el-option
                v-for="teacher in teachers"
                :key="teacher.id"
                :label="teacher.name"
                :value="teacher.id"
              />
            </el-select>
          </el-form-item>
          
          <el-form-item label="é¢å‘æœºæ„">
            <el-input v-model="achievementForm.content_json.issuing_organization" />
          </el-form-item>
          
          <el-form-item label="é¢å‘æ—¥æœŸ">
            <el-input v-model="achievementForm.content_json.issue_date" />
          </el-form-item>
          
          <el-form-item label="è·å¥–ç­‰çº§">
            <el-input v-model="achievementForm.content_json.award_level" />
          </el-form-item>
          
          <el-form-item label="è¯ä¹¦é¢„è§ˆ">
            <el-image
              :src="getImageUrl(fileUrl)"
              style="width: 300px"
              fit="contain"
            />
          </el-form-item>
        </el-form>
        
        <div class="button-group">
          <el-button @click="currentStep = 0">ä¸Šä¸€æ­¥</el-button>
          <el-button
            type="primary"
            :loading="submitting"
            @click="submitAchievement"
          >
            æäº¤æˆæœ
          </el-button>
        </div>
      </div>
      
      <!-- æ­¥éª¤3: å®Œæˆ -->
      <div v-if="currentStep === 2" class="step-content">
        <el-result
          icon="success"
          title="æäº¤æˆåŠŸ"
          sub-title="æ‚¨çš„æˆæœå·²æäº¤ï¼Œç­‰å¾…å®¡æ ¸"
        >
          <template #extra>
            <el-button type="primary" @click="$router.push('/student/achievements')">
              æŸ¥çœ‹æˆ‘çš„æˆæœ
            </el-button>
            <el-button @click="resetForm">ç»§ç»­æäº¤</el-button>
          </template>
        </el-result>
      </div>
    </el-card>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { ElMessage } from 'element-plus';
import { UploadFilled } from '@element-plus/icons-vue';
import { recognizeCertificate as recognizeAPI, submitAchievement as submitAPI } from '@/api/student';
import { getTeachers } from '@/api/common';

const currentStep = ref(0);
const recognizing = ref(false);
const submitting = ref(false);
const selectedFile = ref(null);
const fileUrl = ref('');
const teachers = ref([]);

const achievementForm = reactive({
  title: '',
  type: 'competition',
  teacher_id: null,
  content_json: {
    issuing_organization: '',
    issue_date: '',
    award_level: ''
  },
  evidence_url: ''
});

// åŠ è½½æ•™å¸ˆåˆ—è¡¨
onMounted(async () => {
  try {
    teachers.value = await getTeachers();
  } catch (error) {
    ElMessage.error('åŠ è½½æ•™å¸ˆåˆ—è¡¨å¤±è´¥');
  }
});

// æ–‡ä»¶é€‰æ‹©
const handleFileChange = (file) => {
  selectedFile.value = file.raw;
};

// è¯†åˆ«è¯ä¹¦
const recognizeCertificate = async () => {
  try {
    recognizing.value = true;
    const result = await recognizeAPI(selectedFile.value);
    
    // å¡«å……è¡¨å•
    const { recognized_data, file_url } = result;
    achievementForm.title = recognized_data.title || '';
    achievementForm.type = recognized_data.suggested_type || 'competition';
    achievementForm.content_json = {
      issuing_organization: recognized_data.issuer || '',
      issue_date: recognized_data.date || '',
      award_level: recognized_data.award_level || '',
      certificate_number: recognized_data.certificate_number || ''
    };
    achievementForm.evidence_url = file_url;
    fileUrl.value = file_url;
    
    ElMessage.success('è¯†åˆ«æˆåŠŸï¼è¯·ç¡®è®¤ä¿¡æ¯');
    currentStep.value = 1;
  } catch (error) {
    ElMessage.error('è¯†åˆ«å¤±è´¥: ' + error.message);
  } finally {
    recognizing.value = false;
  }
};

// æäº¤æˆæœ
const submitAchievement = async () => {
  if (!achievementForm.teacher_id) {
    ElMessage.warning('è¯·é€‰æ‹©æŒ‡å¯¼æ•™å¸ˆ');
    return;
  }
  
  try {
    submitting.value = true;
    await submitAPI(achievementForm);
    
    currentStep.value = 2;
  } catch (error) {
    ElMessage.error('æäº¤å¤±è´¥: ' + error.message);
  } finally {
    submitting.value = false;
  }
};

// é‡ç½®è¡¨å•
const resetForm = () => {
  currentStep.value = 0;
  selectedFile.value = null;
  fileUrl.value = '';
  Object.assign(achievementForm, {
    title: '',
    type: 'competition',
    teacher_id: null,
    content_json: {
      issuing_organization: '',
      issue_date: '',
      award_level: ''
    },
    evidence_url: ''
  });
};

// è·å–å›¾ç‰‡å®Œæ•´URL
const getImageUrl = (url) => {
  return `${import.meta.env.VITE_API_BASE_URL}${url}`;
};
</script>

<style scoped>
.submit-container {
  max-width: 800px;
  margin: 20px auto;
}

.step-content {
  margin-top: 40px;
}

.button-group {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}
</style>
```

---

### 3. æˆæœåˆ—è¡¨é¡µ (`AchievementList.vue`)

```vue
<template>
  <div class="list-container">
    <el-card>
      <div class="header">
        <h2>æˆ‘çš„æˆæœ</h2>
        <el-button type="primary" @click="$router.push('/student/submit')">
          æäº¤æ–°æˆæœ
        </el-button>
      </div>
      
      <!-- çŠ¶æ€ç­›é€‰ -->
      <el-radio-group v-model="statusFilter" @change="loadAchievements">
        <el-radio-button label="">å…¨éƒ¨</el-radio-button>
        <el-radio-button label="pending">å¾…å®¡æ ¸</el-radio-button>
        <el-radio-button label="approved">å·²é€šè¿‡</el-radio-button>
        <el-radio-button label="rejected">å·²æ‹’ç»</el-radio-button>
      </el-radio-group>
      
      <!-- æˆæœåˆ—è¡¨ -->
      <el-table :data="achievements" v-loading="loading" style="margin-top: 20px">
        <el-table-column prop="title" label="æˆæœæ ‡é¢˜" />
        <el-table-column prop="type" label="ç±»å‹" width="120">
          <template #default="{ row }">
            {{ typeMap[row.type] || row.type }}
          </template>
        </el-table-column>
        <el-table-column prop="teacher_name" label="æŒ‡å¯¼æ•™å¸ˆ" width="120" />
        <el-table-column prop="status" label="çŠ¶æ€" width="100">
          <template #default="{ row }">
            <el-tag :type="statusTypeMap[row.status]">
              {{ statusMap[row.status] }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="created_at" label="æäº¤æ—¶é—´" width="180">
          <template #default="{ row }">
            {{ formatDate(row.created_at) }}
          </template>
        </el-table-column>
        <el-table-column label="æ“ä½œ" width="150">
          <template #default="{ row }">
            <el-button link @click="viewDetail(row)">æŸ¥çœ‹</el-button>
            <el-button
              v-if="row.evidence_url"
              link
              @click="viewCertificate(row.evidence_url)"
            >
              æŸ¥çœ‹è¯ä¹¦
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
    
    <!-- è¯¦æƒ…å¯¹è¯æ¡† -->
    <el-dialog v-model="dialogVisible" title="æˆæœè¯¦æƒ…" width="600px">
      <el-descriptions :column="1" border v-if="currentAchievement">
        <el-descriptions-item label="æ ‡é¢˜">
          {{ currentAchievement.title }}
        </el-descriptions-item>
        <el-descriptions-item label="ç±»å‹">
          {{ typeMap[currentAchievement.type] }}
        </el-descriptions-item>
        <el-descriptions-item label="æŒ‡å¯¼æ•™å¸ˆ">
          {{ currentAchievement.teacher_name }}
        </el-descriptions-item>
        <el-descriptions-item label="çŠ¶æ€">
          <el-tag :type="statusTypeMap[currentAchievement.status]">
            {{ statusMap[currentAchievement.status] }}
          </el-tag>
        </el-descriptions-item>
        <el-descriptions-item
          v-if="currentAchievement.audit_comment"
          label="å®¡æ ¸æ„è§"
        >
          {{ currentAchievement.audit_comment }}
        </el-descriptions-item>
      </el-descriptions>
      
      <el-image
        v-if="currentAchievement?.evidence_url"
        :src="getImageUrl(currentAchievement.evidence_url)"
        style="width: 100%; margin-top: 20px"
        fit="contain"
      />
    </el-dialog>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { getMyAchievements } from '@/api/student';
import { ElMessage } from 'element-plus';
import dayjs from 'dayjs';

const loading = ref(false);
const statusFilter = ref('');
const achievements = ref([]);
const dialogVisible = ref(false);
const currentAchievement = ref(null);

const typeMap = {
  competition: 'å­¦ç§‘ç«èµ›',
  paper: 'è®ºæ–‡å‘è¡¨',
  patent: 'ä¸“åˆ©',
  project: 'é¡¹ç›®',
  certificate: 'èŒä¸šè¯ä¹¦'
};

const statusMap = {
  pending: 'å¾…å®¡æ ¸',
  approved: 'å·²é€šè¿‡',
  rejected: 'å·²æ‹’ç»'
};

const statusTypeMap = {
  pending: 'warning',
  approved: 'success',
  rejected: 'danger'
};

onMounted(() => {
  loadAchievements();
});

const loadAchievements = async () => {
  try {
    loading.value = true;
    achievements.value = await getMyAchievements(statusFilter.value || null);
  } catch (error) {
    ElMessage.error('åŠ è½½å¤±è´¥');
  } finally {
    loading.value = false;
  }
};

const viewDetail = (row) => {
  currentAchievement.value = row;
  dialogVisible.value = true;
};

const viewCertificate = (url) => {
  window.open(getImageUrl(url), '_blank');
};

const formatDate = (dateStr) => {
  return dayjs(dateStr).format('YYYY-MM-DD HH:mm');
};

const getImageUrl = (url) => {
  return `${import.meta.env.VITE_API_BASE_URL}${url}`;
};
</script>

<style scoped>
.list-container {
  max-width: 1200px;
  margin: 20px auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
</style>
```

---

## ğŸ’¡ å®ç”¨å·¥å…·å‡½æ•°

### `utils/format.js`

```javascript
import dayjs from 'dayjs';

/**
 * æ ¼å¼åŒ–æ—¥æœŸ
 */
export function formatDate(date, format = 'YYYY-MM-DD HH:mm:ss') {
  return dayjs(date).format(format);
}

/**
 * è·å–å®Œæ•´å›¾ç‰‡URL
 */
export function getImageUrl(relativeUrl) {
  if (!relativeUrl) return '';
  if (relativeUrl.startsWith('http')) return relativeUrl;
  return `${import.meta.env.VITE_API_BASE_URL}${relativeUrl}`;
}

/**
 * æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
 */
export function formatFileSize(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}
```

---

## âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. CORSè·¨åŸŸé—®é¢˜

**é—®é¢˜**: å¼€å‘ç¯å¢ƒå‰ç«¯è¯·æ±‚åç«¯å‡ºç°CORSé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**: 
åç«¯å·²é…ç½®CORSï¼Œç¡®ä¿å‰ç«¯URLåœ¨ç™½åå•ä¸­ï¼š
```env
# åç«¯ .env
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
```

---

### 2. æ–‡ä»¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

```vue
<el-upload
  :on-progress="handleProgress"
>
</el-upload>

<script setup>
const uploadProgress = ref(0);

const handleProgress = (event) => {
  uploadProgress.value = Math.round(event.percent);
};
</script>
```

---

### 3. Tokenåˆ·æ–°æœºåˆ¶

å½“å‰Tokenæœ‰æ•ˆæœŸ24å°æ—¶ï¼Œæ— è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ã€‚å»ºè®®ï¼š

```javascript
// åœ¨å“åº”æ‹¦æˆªå™¨ä¸­æ£€æŸ¥Tokenæ˜¯å¦å¿«è¿‡æœŸ
if (response.headers['x-token-expires-in']) {
  const expiresIn = parseInt(response.headers['x-token-expires-in']);
  if (expiresIn < 3600) {  // å°äº1å°æ—¶
    // æç¤ºç”¨æˆ·å³å°†è¿‡æœŸ
    ElMessage.warning('ç™»å½•å³å°†è¿‡æœŸï¼Œè¯·ä¿å­˜å·¥ä½œ');
  }
}
```

---

### 4. å¤§æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–

```javascript
export function uploadLargeFile(file, onProgress) {
  const formData = new FormData();
  formData.append('file', file);
  
  return request({
    url: '/api/v1/common/upload',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    },
    timeout: 120000,  // 2åˆ†é’Ÿ
    onUploadProgress: (progressEvent) => {
      const percentCompleted = Math.round(
        (progressEvent.loaded * 100) / progressEvent.total
      );
      onProgress && onProgress(percentCompleted);
    }
  });
}
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å›¾ç‰‡æ‡’åŠ è½½

```vue
<el-image
  :src="imageUrl"
  lazy
  :preview-src-list="[imageUrl]"
/>
```

---

### 2. åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨

å¯¹äºé•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š

```bash
npm install vue-virtual-scroller
```

---

### 3. è¯·æ±‚é˜²æŠ–

```javascript
import { debounce } from 'lodash-es';

const searchStudents = debounce(async (keyword) => {
  // æœç´¢é€»è¾‘
}, 500);
```

---

## ğŸ“š æ¨èèµ„æº

- **Vue 3æ–‡æ¡£**: https://vuejs.org/
- **Element Plus**: https://element-plus.org/
- **Pinia**: https://pinia.vuejs.org/
- **Axios**: https://axios-http.com/
- **Day.js**: https://day.js.org/

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2026-01-28  
**ç›®æ ‡æ¡†æ¶**: Vue 3 + Element Plus + Pinia
